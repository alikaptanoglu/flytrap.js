/*! flytrap.js 2015-08-24 */
(function(){function a(){this.ordinal=0}DependencyTypes={Regular:0,Anti:1,SkipIfExists:2,SkipIfNotExists:3,Parameter:4};var b=function(a){this.type=a};(function(){this.isRegular=function(){return this.type===DependencyTypes.Regular},this.isAnti=function(){return this.type===DependencyTypes.Anti},this.isParameter=function(){return this.type===DependencyTypes.Parameter},this.isSkipIfExists=function(){return this.type===DependencyTypes.SkipIfExists},this.isSkipIfNotExists=function(){return this.type===DependencyTypes.SkipIfNotExists}}).call(b.prototype),b.deduce=function(a){if("string"==typeof a)return DependencyTypes.Regular;var b={_anti_:DependencyTypes.Anti,_antidependency_:DependencyTypes.Anti,_parameter_:DependencyTypes.Parameter,_optional_:DependencyTypes.Optional,_skipIfExists_:DependencyTypes.SkipIfExists,_skipIfNotExists_:DependencyTypes.SkipIfNotExists},c=Object.getOwnPropertyNames(a);return 1===c.length?b[c[0]]||DependencyTypes.Regular:DependencyTypes.Regular};var c=function(a,c){this.type=new b(c||b.deduce(a)),this.isFulfilled=!1;var d;this.selector=a._parameter_!==d?a._parameter_:a._anti_||a._antidependency_||a._optional_||a._skipIfExists_||a._skipIfNotExists_||a};(function(){this.attemptToFulfill=function(){if(this.isFulfilled)return!1;var a=c._query(this.selector,!0);return this.type.isRegular()&&a.length>0||this.type.isAnti()&&0==a.length||this.type.isParameter()?(this.isFulfilled=!0,!0):!1},this.getDependencyValue=function(){return this.type.isParameter()?this.selector:c._query(this.selector)},this.isSkippable=function(){var a=c._query(this.selector);return this.type.isSkipIfExists()&&a.length>0||this.type.isSkipIfNotExists()&&0==a.length},this.reset=function(){this.isFulfilled=!1}}).call(c.prototype),c.setDOMContext=function(a){c.DOMContext=a},c.getElements=function(a){return a.map(function(a){return c._query(a)})},c._query=function(a,b){var d="undefined"!=typeof Sizzle;try{var e=d?Sizzle(a,c.DOMContext):document.querySelectorAll(a)}catch(f){b&&console.error(d?f.toString():"selector "+a+" is invalid.  Consider including a reference to Sizzle.js.")}return e||[]};var d=function(){this.dependencies=[]};(function(){this.addDependency=function(a,b){this.dependencies.push(new c(a,b))},this.dependenciesAreFulfilled=function(){for(var a=0;a<this.dependencies.length;++a)if(!this.dependencies[a].attemptToFulfill()&&!this.dependencies[a].isFulfilled)return!1;return!0},this.attemptToFulfillDependencies=function(){for(var a=0;a<this.dependencies.length;++a)this.dependencies[a].attemptToFulfill()},this.reset=function(){for(var a=0;a<this.dependencies.length;++a)this.dependencies[a].reset()},this.shouldBeSkipped=function(){for(var a=0;a<this.dependencies.length;++a)if(this.dependencies[a].isSkippable())return!0;return!1},this.getDependencyValues=function(){for(var a=[],b=0;b<this.dependencies.length;++b)a.push(this.dependencies[b].getDependencyValue());return a},this.convertToDependencyValues=function(a){for(var b=[],d=0;d<a.length;++d)b.push(new c(a[d]).getDependencyValue());return b},this.query=function(a,b){return c._query(a,b)}}).call(d.prototype),d.setDOMContext=function(a){c.setDOMContext(a)},d.getElements=function(a){return c.getElements(a)};var e=function(a){this.totalExecutions=0,this.dependencyManager=new d,this.numFulfillAttempts=0,this.name=a.name||"",this.skipAfter=a.skipAfter||60,this.dependencies=[]||a.dependencies,this.callback=function(){},this.subcommands=[],this.afterDelay=a.runAfterDelay||1e3};(function(){this.click=function(a){this.withDependency(a);var b=new e({name:"Click "+a}).withDependency(a).withCallback(function(a){for(var b=0;b<a.length;++b){var c=document.createEvent("Event");c.initEvent("click",!0,!0),a[b].dispatchEvent(c)}});return this.subcommands.push(b),this},this.bubbleEvent=function(a,b){this.withDependency(a);var c=new e({name:"Bubble "+b+" "+a}).withDependency(a).withParameter(b).withCallback(function(a,b){for(var c=0;c<a.length;++c){var d=document.createEvent("Event");d.initEvent(b,!0,!0),a[c].dispatchEvent(d)}});return this.subcommands.push(c),this},this.hardClick=function(a){return this.bubbleEvent(a,"click")},this.uncheck=function(a){return this.check(a,!1)},this.check=function(a,b){this.withDependency(a),null==b&&(b=!0);var c=new e({name:(b?"Checking ":"Unchecking ")+a}).withDependency(a).withParameter(b).withCallback(function(a,b){for(var c=0;c<a.length;++c)a[c].checked=b});return this.subcommands.push(c),this},this.value=function(a,b){this.withDependency(a),null==b&&(b=!0);var c=new e({name:"Setting value of "+a+" to "+b}).withDependency(a).withParameter(b).withCallback(function(a,b){for(var c=0;c<a.length;++c)a[c].value=b.selector||b});return this.subcommands.push(c),this},this.hash=function(a){var b=new e({name:"Setting window.location.hash: "+a}).withParameter(a).withCallback(function(a){window.location.hash=a});return this.subcommands.push(b),this},this.log=function(a){var b=new e({name:"Logging message: "+a}).withParameter(a).withCallback(function(a){console.log(a)});return this.subcommands.push(b),this},this.focus=function(a){this.withDependency(a);var b=new e({name:"Focus on "+a}).withDependency(a).withCallback(function(a){for(var b=0;b<a.length;++b)a[b].focus()});return this.subcommands.push(b),this},this["goto"]=function(a){var b=new e({name:"Changing URL to "+a}).withParameter(a).withCallback(function(a){window.location.href=a});return this.subcommands.push(b),this},this.autocomplete=function(a,b,c){this.withDependency(a),this.withDependency(a+"_value");var d=new e({name:"Autocomplete "+a}).withDependency(a).withDependency(a+"_value").withParameter(b).withParameter(c).withCallback(function(a,b,c,d){a.val(d+" - "+c),b.val(d);var e=document.createEvent("HTMLEvents");e.initEvent("change",!1,!0),b[0].dispatchEvent(e)});return this.subcommands.push(d),this},this.antidependency=function(a){return this.withDependency({_anti_:a})},this.dependency=this.withDependency=function(a,b){return this.dependencyManager.addDependency(a,b),this},this.parameter=this.withParameter=function(a){return this.withDependency({_parameter_:a}),this},this.run=function(a,b){for(var c=new e({name:"Subcommand callback"}),d=0;d<a.length;++d)void 0!==a[d]._parameter_?c.withParameter(a[d]._parameter_):(this.withDependency(a[d]),c.withDependency(a[d]));return c.withCallback(b),this.subcommands.push(c),this},this.each=this.eachWithDependencyCheck=function(a,b){var c=new e({name:"Subcommand each w/ dep check"}).withParameter(a).withParameter(b).withCallback(function(a,b){for(var c=0;c<a.length;++c)b(a[c],c)});return this.subcommands.push(c),this},this.withCallback=function(a){return this.callback=a,this},this.skipAfterAttempts=function(a){return this.skipAfter=a,this},this.attemptToFulfillDependencies=function(){this.dependencyManager.attemptToFulfillDependencies(),++this.numFulfillAttempts},this.dependenciesAreFulfilled=function(){return this.dependencyManager.dependenciesAreFulfilled()},this.shouldBeSkipped=function(){return this.numFulfillAttempts>this.skipAfter?!0:this.dependencyManager.shouldBeSkipped()},this.afterSeconds=function(a){return this.runAfterDelay(1e3*a)},this.runAfterDelay=function(a){return this.afterDelay=a,this},this.exists=function(a){return this.withParameter(a).withCallback(function(a){return this.dependencyManager.query(a,!0).length>0})},this.execute=function(){for(var a=0;a<this.subcommands.length;++a)this.subcommands[a].execute();var b=this.dependencyManager.getDependencyValues();b.push(this.totalExecutions++);var c=this.callback.apply(this,b);return c},this.reset=function(){numFulfilledAttempts=0,this.dependencyManager.reset();for(var a=0;a<this.subcommands.length;++a)this.subcommands[a].reset()}}).call(e.prototype);var f=function(a,b){var c;this.interval=a,this.callback=b,this.start=function(){this.stop(),c=setTimeout(this.callback,this.interval)},this.stop=function(){clearTimeout(c)}};LocalStoragePersister={};var g="_flytrapP_",h={currentWorkflow:g+"CurrentWorkflow",currentCode:g+"CurrentCode"};if(LocalStoragePersister.getCurrentWorkflow=function(){return sessionStorage.getItem(h.currentWorkflow)},LocalStoragePersister.setCurrentWorkflow=function(a){sessionStorage.setItem(h.currentWorkflow,a)},LocalStoragePersister.persistNodeControlFlowInfo=function(a){var b=a.nodeId,c=JSON.stringify(a.nodeInfo);sessionStorage.setItem(g+b,c)},LocalStoragePersister.getNodeControlFlowInfo=function(a){var b=sessionStorage.getItem(g+a);return JSON.parse(b)},LocalStoragePersister.setCurrentWorkflowCode=function(a){sessionStorage.setItem(h.currentCode,a)},LocalStoragePersister.getCurrentWorkflowCode=function(){return sessionStorage.getItem(h.currentCode)},LocalStoragePersister.clearKeys=function(){for(var a in sessionStorage)sessionStorage.hasOwnProperty(a)&&0===a.indexOf(g)&&sessionStorage.removeItem(a)},"undefined"==typeof Storage)throw"no local storage support";var i=function(a){this.commands=a.commands||[],this.workflowName=a.workflowName,this.defaultSkipAfter=a.defaultSkipAfter||1e3,this.timeInterval=a.timeInterval||1e3,this.dependencyManager=a.dependencyManager,this.persister=a.persister||LocalStoragePersister,this.delegate=a.delegate||{commandDidComplete:function(){},workflowDidComplete:function(){},checkpointWasReached:function(){},assertionDidComplete:function(){},commandMayExecute:function(){}};this.go=function(a){a=a||this.timeInterval;var b=d();b&&l({nodeDesc:b.getModifiersPretty(),inMs:a,selectors:b.getSelectors()}),c.interval=a,LocalStoragePersister.setCurrentWorkflow(this.workflowName),c.start()},this.stop=function(){LocalStoragePersister.setCurrentWorkflow(""),m.reset(),j({name:this.workflowName}),c.stop(),console.log("All done!")};var b=function(){if(this.dependencyManager.dependenciesAreFulfilled()){var a=d();if(!a)return this.persister.clearKeys(),this.stop();var b=this.persister.getNodeControlFlowInfo(a.nodeId);if(a.setControlFlowInfo(b),h(a))return a.didExecute(),void(d()?(g(),this.go()):(this.persister.clearKeys(),this.stop()));var c=a.getCommand();if(!c)return void this.stop();if(c.attemptToFulfillDependencies(),a.numberOfDependencyFulfillmentAttempts++,c.shouldBeSkipped())console.log("[Skipping] "+a.nodeId+" "+c.name+" ... "),a.didExecute(),i(c,a.getControlFlowInfo(),"skipped");else if(c.dependenciesAreFulfilled()){if(console.log(a.nodeId+" "+c.name+" ... "),c.execute(),a.didExecute(),i(c,a.getControlFlowInfo(),"executed"),!d())return this.persister.clearKeys(),void this.stop();g(),this.dependencyManager.reset()}else i(c,a.getControlFlowInfo(),"spinning")}this.go()}.bind(this),c=new f(this.timeInterval,b),d=function(){return e(this.commands)}.bind(this),e=function(a){if(a.shouldExecute())return a;if(!a.shouldEnterBlock())return null;for(var b=0;b<a.children.length;++b){var c=e(a.children[b]);if(c)return c}return null}.bind(this),g=function(){var a=d();this.timeInterval=a.getAfterDelay()||this.timeInterval}.bind(this),h=function(a){switch(a.type){case"assert":return n(a.getAssertionResult()),!0;case"checkpoint":return k(a.getCheckpointDescription()),!0;default:return!1}}.bind(this),i=function(a,b,c){var d={status:c,command:{workflowName:this.workflowName,commandDesc:(a.subcommands[0]||a).name},nodeInfo:b};o(this.delegate.commandDidComplete,d)}.bind(this),j=function(a){o(this.delegate.workflowDidComplete,a)}.bind(this),k=function(a){o(this.delegate.checkpointWasReached,a)}.bind(this),l=function(a){o(this.delegate.commandMayExecute,a)}.bind(this),n=function(a){o(this.delegate.assertionDidComplete,a)}.bind(this),o=function(a,b){null!=a&&setTimeout(function(){a(b)},0)}.bind(this)};window.confirm=function(a){return console.log("Answering YES to: "+a),!0};var j=function(a){if(null==a||null==a.name)throw"A workflow name is required.";if(this.commands=[],this.dependencyManager=new d,this.name=a.name,this["do"]=this.perform=this.addCommand=function(a){var b=new e({name:a});return this.commands.push(b),b},this.withDependency=function(a,b){return this.dependencyManager.addDependency(a,b),this},this.workflowExecutor=null,this.go=function(){this.workflowExecutor=new i({commands:this.annotatedCommands,dependencyManager:this.dependencyManager,workflowName:this.name,delegate:this.delegate}),this.workflowExecutor.go()},this.antidependency=this.withAntidependency=function(a){return this.withDependency({_anti_:a})},this.withCommandTree=function(a){for(var b=0;b<a.modifiers.length;++b)for(var c=0;c<a.modifiers[b].operands.length;++c){var d=a.evaluateExpression(a.modifiers[b].operands[c]);this[a.modifiers[b].type](d)}return this.annotatedCommands=a,this},this.delegate={},this.delegate.commandMayExecute=function(b){var c=d.getElements(b.selectors);c.forEach(function(a){for(var b=0,c=a.length;c>b;++b)a[b].classList.add("flytrap-active-command")}),a.commandMayExecute&&a.commandMayExecute(b)},this.delegate.commandDidComplete=function(b){if("spinning"!==b.status)for(var c=document.getElementsByClassName("flytrap-active-command"),d=c.length-1;d>=0;--d)c[d].classList.remove("flytrap-active-command");a.commandDidComplete&&a.commandDidComplete(b)},this.delegate.workflowDidComplete=a.workflowDidComplete,this.delegate.checkpointWasReached=a.checkpointWasReached,this.delegate.assertionDidComplete=a.assertionDidComplete,null!=a.code){d.setDOMContext(a.DOMContext);var b=z.parse(a.code);z.attachModules(b,function(a){var b=z.buildTree(a);this.withCommandTree(b)}.bind(this))}};j.ExtractModuleReferences=function(a){function b(a,c){if(a&&a.length)for(var d=0,e=a.length;e>d;++d){var f=a[d];"module"===f.type&&f.module.name.expr_str&&c.push(f.module.name.expr_str),b(f.statement_list,c)}}var c=[],d=z.parse(a);return b(d.flytrap.statement_list,c),c};var k={},l=function(a){this.type=a.type,this.operands=a.operands},m=function(){return this.prototype.newId=function(){return this.ordinal++},this.prototype.reset=function(){this.ordinal=0},new this}.call(a),n=function(){function a(){this.yy={}}var b=function(a,b,c,d){for(c=c||{},d=a.length;d--;c[a[d]]=b);return c},c=[1,12],d=[1,13],e=[1,14],f=[1,19],g=[1,20],h=[1,21],i=[1,22],j=[1,23],k=[1,24],l=[1,25],m=[1,26],n=[1,15],o=[1,18],p=[1,16],q=[1,17],r=[1,36],s=[1,32],t=[1,33],u=[1,35],v=[6,20,23,24,29,31,32,33,34,36,37,38,53,55,60,64,67],w=[1,45],x=[1,44],y=[1,46],z=[1,47],A=[1,48],B=[1,51],C=[20,23,24,29,31,32,33,34,36,37,38,53,55,60,67],D=[1,68],E=[6,17,20,22,23,24,29,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67],F=[6,17,20,22,23,24,29,30,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,74,77],G=[1,74],H=[6,17,20,22,23,24,29,30,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,74,77,86],I=[17,22,29,31,32,33,34,36,37,38,39,42,43,45],J=[1,91],K=[1,90],L=[1,89],M=[1,95],N=[6,17,20,22,23,24,29,31,32,33,34,36,37,38,39,42,43,45,53,55,60,64,67],O=[1,97],P=[6,17,20,22,23,24,29,30,31,32,33,34,36,37,38,39,42,43,45,53,55,60,63,64,67,70,74],Q=[17,20,23,24,29,31,32,33,34,36,37,38,53,55,60,67],R=[6,17,20,22,23,24,29,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,77],S=[70,77],T=[17,42,63],U=[6,20,23,24,29,31,32,33,34,36,37,38,53,55,58,60,64,67],V=[6,17,20,22,23,24,29,30,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,74,77,84,86],W={trace:function(){},yy:{},symbols_:{error:2,flytrap_script:3,flytrap_decl:4,stmt_list:5,EOF:6,stmt:7,flytrap_command_decl:8,assignment:9,conditional_stmt:10,each_block:11,execute_stmt:12,FLYTRAP:13,expression:14,flytrap_decl_options:15,flytrap_decl_option:16,ANTIDEPENDENCY:17,expression_list:18,subcommand:19,LEFT_PARENTHESES:20,command_modifiers:21,RIGHT_PARENTHESES:22,CHECKPOINT:23,ASSERT:24,comparable:25,EXISTS:26,command_modifier:27,command_option:28,CLICK:29,BANG:30,CHECK:31,HASH:32,VALUE:33,SET:34,TO:35,FOCUS:36,LOG:37,GOTO:38,AFTER:39,NUMBER:40,seconds:41,DEPENDENCY:42,SKIP:43,attempts:44,REPEAT:45,times:46,SECOND:47,SECONDS:48,TIME:49,TIMES:50,ATTEMPT:51,ATTEMPTS:52,VARIABLE:53,EQUALS:54,EXECUTE:55,with_list:56,"with":57,WITH:58,AS:59,IF:60,conditional_dependencies:61,conditional_block:62,BEGIN:63,END:64,ELSE:65,conditional_dependency:66,EACH:67,IN:68,composition:69,COMMA:70,json_blob:71,array:72,LEFT_BRACKET:73,RIGHT_BRACKET:74,LEFT_BRACE:75,obj_key_list:76,RIGHT_BRACE:77,obj_key:78,PROPERTY:79,COLON:80,concatenation:81,dot_notation:82,dot_list:83,DOT:84,composable:85,PLUS:86,STRING:87,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",13:"FLYTRAP",17:"ANTIDEPENDENCY",20:"LEFT_PARENTHESES",22:"RIGHT_PARENTHESES",23:"CHECKPOINT",24:"ASSERT",26:"EXISTS",29:"CLICK",30:"BANG",31:"CHECK",32:"HASH",33:"VALUE",34:"SET",35:"TO",36:"FOCUS",37:"LOG",38:"GOTO",39:"AFTER",40:"NUMBER",42:"DEPENDENCY",43:"SKIP",45:"REPEAT",47:"SECOND",48:"SECONDS",49:"TIME",50:"TIMES",51:"ATTEMPT",52:"ATTEMPTS",53:"VARIABLE",54:"EQUALS",55:"EXECUTE",58:"WITH",59:"AS",60:"IF",63:"BEGIN",64:"END",65:"ELSE",67:"EACH",68:"IN",70:"COMMA",73:"LEFT_BRACKET",74:"RIGHT_BRACKET",75:"LEFT_BRACE",77:"RIGHT_BRACE",79:"PROPERTY",80:"COLON",84:"DOT",86:"PLUS",87:"STRING"},productions_:[0,[3,3],[5,1],[5,2],[7,1],[7,1],[7,1],[7,1],[7,1],[4,2],[4,3],[15,1],[15,2],[16,2],[8,1],[8,3],[8,2],[8,2],[25,2],[21,1],[21,2],[27,1],[27,1],[19,2],[19,3],[19,2],[19,2],[19,2],[19,4],[19,2],[19,2],[19,2],[28,3],[28,2],[28,2],[28,4],[28,3],[41,1],[41,1],[46,1],[46,1],[44,1],[44,1],[9,3],[12,3],[12,2],[56,1],[56,2],[57,4],[10,4],[10,3],[62,3],[62,7],[61,1],[61,2],[66,2],[66,2],[11,7],[18,1],[18,3],[18,1],[18,3],[14,1],[14,1],[14,1],[72,3],[72,2],[71,3],[76,1],[76,3],[78,3],[78,3],[78,3],[69,1],[82,2],[83,2],[83,3],[81,1],[81,3],[85,1],[85,1],[85,1]],performAction:function(a,b,c,d,e,f){var g=f.length-1;switch(e){case 1:return this.$=f[g-2],this.$.flytrap.statement_list=f[g-1],this.$;case 2:case 11:case 19:case 46:case 53:case 58:case 60:case 75:case 77:this.$=[f[g]];break;case 3:this.$=f[g-1],this.$.push(f[g]);break;case 9:this.$={type:"flytrap",flytrap:{flytrap:f[g],options:[]}};break;case 10:this.$={type:"flytrap",flytrap:{flytrap:f[g-1],options:f[g]}};break;case 12:case 20:this.$=f[g-1],this.$.push(f[g]);break;case 13:case 33:this.$={type:"antidependency",operands:f[g]};break;case 14:this.$={type:"command",command:{command:f[g].type,modifiers:[f[g]]}};break;case 15:this.$={type:"command",command:{command:{type:"expr_str",expr_str:""},modifiers:f[g-1]}};break;case 16:this.$={type:"checkpoint",checkpoint:f[g]};break;case 17:this.$={type:"assert",assert:{comparable:f[g]}};break;case 18:this.$={type:"exists",exists:{operands:[f[g]]}};break;case 23:this.$={type:"click",operands:f[g]};break;case 24:this.$={type:"hardClick",operands:f[g-1]};break;case 25:this.$={type:"check",operands:f[g]};break;case 26:this.$={type:"hash",operands:f[g]};break;case 27:this.$={type:"value",operands:f[g]};break;case 28:this.$={type:"value",operands:[f[g-2],f[g]]};break;case 29:this.$={type:"focus",operands:f[g]};break;case 30:this.$={type:"log",operands:f[g]};break;case 31:this.$={type:"goto",operands:[f[g]]};break;case 32:this.$={type:"afterSeconds",operands:[f[g-1]]};break;case 34:case 55:this.$={type:"dependency",operands:f[g]};break;case 35:this.$={type:"skipAfterAttempts",operands:[f[g-1]]};break;case 36:this.$={type:"repeat",operands:[f[g-1]]};break;case 43:this.$={type:"assignment",assignment:{variable:f[g-2],value:f[g]}};break;case 44:this.$={type:"module",module:{name:f[g-1],inputs:f[g]}};break;case 45:this.$={type:"module",module:{name:f[g]}};break;case 47:this.$=f[g-1],this.$.push(f[g]);break;case 48:this.$={variable:f[g],value:f[g-2]};break;case 49:this.$={type:"if","if":{comparable:f[g-2],then_statements:f[g].then_statements,else_statements:f[g].else_statements,modifiers:f[g-1]}};break;case 50:this.$={type:"if","if":{comparable:f[g-1],then_statements:f[g].then_statements,else_statements:f[g].else_statements}};break;case 51:this.$={then_statements:f[g-1]};break;case 52:this.$={then_statements:f[g-5],else_statements:f[g-1]};break;case 54:this.$=f[g-1],this.$.push(f[g]);break;case 56:this.$={type:"antidependency",operands:f[g]};break;case 57:this.$={type:"each",each:{iterator_var_name:f[g-5],iterator_expr:f[g-3],statement_list:f[g-1]}};break;case 59:case 61:case 69:case 76:case 78:this.$=f[g-2],this.$.push(f[g]);break;case 65:this.$={type:"expr_arr",expr_arr:f[g-1]};break;case 66:this.$={type:"expr_arr",expr_arr:[]};break;case 67:this.$={type:"expr_obj",expr_obj:{props:f[g-1]}};break;case 68:this.$=[f[g]];break;case 70:case 71:case 72:this.$={key:{type:"expr_str",expr_str:f[g-2]},value:f[g]};break;case 73:this.$=1==f[g].length?f[g][0]:{type:"expr_concat",expr_concat:f[g]};break;case 74:this.$={keys:f[g],source:{type:"expr_var",expr_var:{variableName:f[g-1]}}};break;case 79:var h="''"==f[g]?"":f[g].substring(1,this.$.length-1).replace(/\'\'/g,"'");this.$={type:"expr_str",expr_str:h};break;case 80:this.$={type:"expr_var",expr_var:{variableName:f[g]}};break;case 81:this.$=1==f[g].length?f[g][0]:{type:"expr_dot",expr_dot:f[g]}}},table:[{3:1,4:2,13:[1,3]},{1:[3]},{5:4,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,67:q},{14:27,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},{6:[1,38],7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,67:q},b(v,[2,2]),b(v,[2,4]),b(v,[2,5]),b(v,[2,6]),b(v,[2,7]),b(v,[2,8]),b(v,[2,14]),{17:w,19:42,21:40,27:41,28:43,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,39:x,42:y,43:z,45:A},{14:49,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},{25:50,26:B},{54:[1,52]},{25:53,26:B},{53:[1,54]},{14:55,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},{18:56,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{18:59,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{18:60,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{18:61,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{14:62,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},{18:63,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{18:64,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{14:65,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},b(C,[2,9],{15:66,16:67,17:D}),b(E,[2,62]),b(E,[2,63]),b(E,[2,64]),b(F,[2,73],{86:[1,69]}),{18:70,53:r,69:57,71:58,74:[1,71],75:t,81:31,82:37,85:34,87:u},{76:72,78:73,79:G},b(H,[2,77]),b(H,[2,79]),b(H,[2,80],{83:75,84:[1,76]}),b(H,[2,81]),{1:[2,1]},b(v,[2,3]),{17:w,19:42,22:[1,77],27:78,28:43,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,39:x,42:y,43:z,45:A},b(I,[2,19]),b(I,[2,21]),b(I,[2,22]),{40:[1,79]},{18:80,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{18:81,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{39:[1,82]},{40:[1,83]},b(v,[2,16]),b(v,[2,17]),{14:84,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},{14:85,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},{17:J,42:K,61:86,62:87,63:L,66:88},{68:[1,92]},b(v,[2,45],{56:93,57:94,58:M}),b(N,[2,23],{30:[1,96],70:O}),b(P,[2,58]),b(P,[2,60]),b(N,[2,25],{70:O}),b(N,[2,26],{70:O}),b(N,[2,27],{70:O}),{35:[1,98]},b(N,[2,29],{70:O}),b(N,[2,30],{70:O}),b(N,[2,31]),b(C,[2,10],{16:99,17:D}),b(Q,[2,11]),{18:100,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{53:r,82:37,85:101,87:u},{70:O,74:[1,102]},b(R,[2,66]),{70:[1,104],77:[1,103]},b(S,[2,68]),{80:[1,105]},b(H,[2,74],{84:[1,106]}),{79:[1,107]},b(v,[2,15]),b(I,[2,20]),{41:108,47:[1,109],48:[1,110]},b(I,[2,33],{70:O}),b(I,[2,34],{70:O}),{40:[1,111]},{46:112,49:[1,113],50:[1,114]},b([6,17,20,23,24,29,31,32,33,34,36,37,38,42,53,55,60,63,64,67],[2,18]),b(v,[2,43]),{17:J,42:K,62:115,63:L,66:116},b(v,[2,50]),b(T,[2,53]),{5:117,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,67:q},{18:118,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{18:119,53:r,69:57,71:58,75:t,81:31,82:37,85:34,87:u},{14:120,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},b(v,[2,44],{57:121,58:M}),b(U,[2,46]),{14:122,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},b(N,[2,24]),{53:r,69:123,71:124,75:t,81:31,82:37,85:34,87:u},{14:125,53:r,69:28,71:30,72:29,73:s,75:t,81:31,82:37,85:34,87:u},b(Q,[2,12]),b(Q,[2,13],{70:O}),b(H,[2,78]),b(R,[2,65]),b(F,[2,67]),{78:126,79:G},{53:r,69:127,71:128,72:129,73:s,75:t,81:31,82:37,85:34,87:u},{79:[1,130]},b(V,[2,75]),b(I,[2,32]),b(I,[2,37]),b(I,[2,38]),{44:131,51:[1,132],52:[1,133]},b(I,[2,36]),b(I,[2,39]),b(I,[2,40]),b(v,[2,49]),b(T,[2,54]),{7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,64:[1,134],67:q},b(T,[2,55],{70:O}),b(T,[2,56],{70:O}),{63:[1,135]},b(U,[2,47]),{59:[1,136]},b(P,[2,59]),b(P,[2,61]),b(N,[2,28]),b(S,[2,69]),b(S,[2,70]),b(S,[2,71]),b(S,[2,72]),b(V,[2,76]),b(I,[2,35]),b(I,[2,41]),b(I,[2,42]),b(v,[2,51],{65:[1,137]}),{5:138,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,67:q},{53:[1,139]},{63:[1,140]},{7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,64:[1,141],67:q},b(U,[2,48]),{5:142,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,67:q},b(v,[2,57]),{7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:c,23:d,24:e,29:f,31:g,32:h,33:i,34:j,36:k,37:l,38:m,53:n,55:o,60:p,64:[1,143],67:q},b(v,[2,52])],defaultActions:{38:[2,1]},parseError:function(a,b){if(!b.recoverable)throw new Error(a);this.trace(a)},parse:function(a){function b(){var a;return a=o.lex()||m,"number"!=typeof a&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1,n=f.slice.call(arguments,1),o=Object.create(this.lexer),p={yy:{}};for(var q in this.yy)Object.prototype.hasOwnProperty.call(this.yy,q)&&(p.yy[q]=this.yy[q]);o.setInput(a,p.yy),p.yy.lexer=o,p.yy.parser=this,"undefined"==typeof o.yylloc&&(o.yylloc={});var r=o.yylloc;f.push(r);var s=o.options&&o.options.ranges;this.parseError="function"==typeof p.yy.parseError?p.yy.parseError:Object.getPrototypeOf(this).parseError;for(var t,u,v,w,x,y,z,A,B,C={};;){if(v=d[d.length-1],this.defaultActions[v]?w=this.defaultActions[v]:((null===t||"undefined"==typeof t)&&(t=b()),w=g[v]&&g[v][t]),"undefined"==typeof w||!w.length||!w[0]){var D="";B=[];for(y in g[v])this.terminals_[y]&&y>l&&B.push("'"+this.terminals_[y]+"'");D=o.showPosition?"Parse error on line "+(i+1)+":\n"+o.showPosition()+"\nExpecting "+B.join(", ")+", got '"+(this.terminals_[t]||t)+"'":"Parse error on line "+(i+1)+": Unexpected "+(t==m?"end of input":"'"+(this.terminals_[t]||t)+"'"),this.parseError(D,{text:o.match,token:this.terminals_[t]||t,line:o.yylineno,loc:r,expected:B})}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+t);switch(w[0]){case 1:d.push(t),e.push(o.yytext),f.push(o.yylloc),d.push(w[1]),t=null,u?(t=u,u=null):(j=o.yyleng,h=o.yytext,i=o.yylineno,r=o.yylloc,k>0&&k--);break;case 2:if(z=this.productions_[w[1]][1],C.$=e[e.length-z],C._$={first_line:f[f.length-(z||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(z||1)].first_column,last_column:f[f.length-1].last_column},s&&(C._$.range=[f[f.length-(z||1)].range[0],f[f.length-1].range[1]]),x=this.performAction.apply(C,[h,j,i,p.yy,w[1],e,f].concat(n)),"undefined"!=typeof x)return x;z&&(d=d.slice(0,-1*z*2),e=e.slice(0,-1*z),f=f.slice(0,-1*z)),d.push(this.productions_[w[1]][0]),e.push(C.$),f.push(C._$),A=g[d[d.length-2]][d[d.length-1]],d.push(A);break;case 3:return!0}}return!0}},X=function(){var a={EOF:1,parseError:function(a,b){if(!this.yy.parser)throw new Error(a);this.yy.parser.parseError(a,b)},setInput:function(a,b){return this.yy=b||this.yy||{},this._input=a,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.offset++,this.match+=a,this.matched+=a;var b=a.match(/(?:\r\n?|\n).*/g);return b?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),a},unput:function(a){var b=a.length,c=a.split(/(?:\r\n?|\n)/g);this._input=a+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-b),this.offset-=b;var d=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),c.length-1&&(this.yylineno-=c.length-1);var e=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:c?(c.length===d.length?this.yylloc.first_column:0)+d[d.length-c.length].length-c[0].length:this.yylloc.first_column-b},this.options.ranges&&(this.yylloc.range=[e[0],e[0]+this.yyleng-b]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(a){this.unput(this.match.slice(a))},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=new Array(a.length+1).join("-");return a+this.upcomingInput()+"\n"+b+"^"},test_match:function(a,b){var c,d,e;if(this.options.backtrack_lexer&&(e={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(e.yylloc.range=this.yylloc.range.slice(0))),d=a[0].match(/(?:\r\n?|\n).*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-d[d.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+a[0].length},this.yytext+=a[0],this.match+=a[0],this.matches=a,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(a[0].length),this.matched+=a[0],c=this.performAction.call(this,this.yy,this,b,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),c)return c;if(this._backtrack){for(var f in e)this[f]=e[f];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d;this._more||(this.yytext="",this.match="");for(var e=this._currentRules(),f=0;f<e.length;f++)if(c=this._input.match(this.rules[e[f]]),c&&(!b||c[0].length>b[0].length)){if(b=c,d=f,this.options.backtrack_lexer){if(a=this.test_match(c,e[f]),a!==!1)return a;if(this._backtrack){b=!1;continue}return!1}if(!this.options.flex)break}return b?(a=this.test_match(b,e[d]),a!==!1?a:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var a=this.next();return a?a:this.lex()},begin:function(a){this.conditionStack.push(a)},popState:function(){var a=this.conditionStack.length-1;return a>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(a){return a=this.conditionStack.length-1-Math.abs(a||0),a>=0?this.conditionStack[a]:"INITIAL"
},pushState:function(a){this.begin(a)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(a,b,c,d){switch(c){case 0:break;case 1:return 40;case 2:return 87;case 3:return 13;case 4:return 17;case 5:return 42;case 6:return"PERFORM";case 7:return 29;case 8:return 31;case 9:return 32;case 10:return 39;case 11:return 48;case 12:return 47;case 13:return 60;case 14:return 26;case 15:return 63;case 16:return 64;case 17:return 65;case 18:return 30;case 19:return 33;case 20:return 36;case 21:return 38;case 22:return 37;case 23:return 34;case 24:return 35;case 25:return 43;case 26:return 39;case 27:return 52;case 28:return 51;case 29:return 45;case 30:return 50;case 31:return 49;case 32:return"FOR";case 33:return 67;case 34:return 68;case 35:return 23;case 36:return 24;case 37:return 55;case 38:return 58;case 39:return 59;case 40:return 53;case 41:return 79;case 42:return 54;case 43:return 70;case 44:return 84;case 45:return 73;case 46:return 74;case 47:return 75;case 48:return 77;case 49:return 80;case 50:return 86;case 51:return 20;case 52:return 22;case 53:return 6}},rules:[/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?\b)/,/^(?:'(?:[^\']+|'')+'|'')/,/^(?:flytrap\b)/,/^(?:antidependency\b)/,/^(?:dependency\b)/,/^(?:perform\b)/,/^(?:click\b)/,/^(?:check\b)/,/^(?:hash\b)/,/^(?:after\b)/,/^(?:seconds\b)/,/^(?:second\b)/,/^(?:if\b)/,/^(?:exists\b)/,/^(?:begin\b)/,/^(?:end\b)/,/^(?:else\b)/,/^(?:!)/,/^(?:value\b)/,/^(?:focus\b)/,/^(?:goto\b)/,/^(?:log\b)/,/^(?:set\b)/,/^(?:to\b)/,/^(?:skip\b)/,/^(?:after\b)/,/^(?:attempts\b)/,/^(?:attempt\b)/,/^(?:repeat\b)/,/^(?:times\b)/,/^(?:time\b)/,/^(?:for\b)/,/^(?:each\b)/,/^(?:in\b)/,/^(?:checkpoint\b)/,/^(?:assert\b)/,/^(?:execute\b)/,/^(?:with\b)/,/^(?:as\b)/,/^(?:@[A-Za-z0-9_]+)/,/^(?:[A-Za-z0-9_]+)/,/^(?:=)/,/^(?:,)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?::)/,/^(?:\+)/,/^(?:\()/,/^(?:\))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],inclusive:!0}}};return a}();return W.lexer=X,a.prototype=W,W.Parser=a,new a}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=n,exports.Parser=n.Parser,exports.parse=function(){return n.parse.apply(n,arguments)},exports.main=function(a){a[1]||(console.log("Usage: "+a[0]+" FILE"),process.exit(1));var b=require("fs").readFileSync(require("path").normalize(a[1]),"utf8");return exports.parser.parse(b)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1)));var o=n,p=Object.create({parent:null,type:null,modifiers:[],variables:[],nodeId:0,children:[],numberOfDependencyFulfillmentAttempts:0,numberOfCompleteExecutions:0,newId:function(){this.nodeId=m.newId()},didExecute:function(){},shouldExecute:function(){return!1},childDidExecute:function(){},shouldEnterBlock:function(){return!0},reset:function(){this.numberOfCompleteExecutions=0,this.numberOfDependencyFulfillmentAttempts=0,this.persistControlFlowInfo()},persistControlFlowInfo:function(){LocalStoragePersister.persistNodeControlFlowInfo(this.getControlFlowInfo())},getCommand:function(){return null},addModifiers:function(a,b){for(var c=0,d=a.length;d>c;++c)b.push(new l(a[c]))},evaluateExpression:function(a){switch(a.type){case"expr_str":return a.expr_str;case"expr_var":return this.getVariableValue(a.expr_var.variableName);case"expr_arr":return a.expr_arr;case"expr_concat":for(var b="",c=0,d=a.expr_concat.length;d>c;++c)b+=this.evaluateExpression(a.expr_concat[c]);return b;case"expr_obj":for(var b={},c=0,d=a.expr_obj.props.length;d>c;++c){var e=a.expr_obj.props[c];b[this.evaluateExpression(e.key)]=this.evaluateExpression(e.value)}return b;case"expr_dot":var b=this.evaluateExpression(a.expr_dot.source);if(!b)return null;for(var c=0,d=a.expr_dot.keys.length;d>c;++c){var f=a.expr_dot.keys[c];b=b[f]}return b;default:return a}},getVariableValue:function(a){return this._getVariableValue(this,a)},_getVariableValue:function(a,b){if(!a)return null;var c=a.checkIterationVariable(b);if(c)return c;if(a.variables)for(var d=0,e=a.variables.length;e>d;++d)if(a.variables[d].key==b){var f=a.variables[d].value;return"string"==typeof f?f:this.evaluateExpression(f)}var g=this._getVariableValue(a.parent,b);return g?this.evaluateExpression(g):null},checkIterationVariable:function(){return null},getAfterDelay:function(){for(var a=0,b=this.modifiers.length;b>a;++a)if("afterSeconds"==this.modifiers[a].type)return 1e3*this.modifiers[a].operands[0];return 1e3},getControlFlowInfo:function(){return{nodeId:this.nodeId,nodeInfo:{numberOfDependencyFulfillmentAttempts:this.numberOfDependencyFulfillmentAttempts,numberOfCompleteExecutions:this.numberOfCompleteExecutions}}},getModifiersPretty:function(){var a=this.modifiers.map(function(a){var b=a.operands.map(function(a){return"'"+this.evaluateExpression(a)+"'"},this);return a.type+" "+b.join(", ")},this);return a.join(";")},getSelectors:function(){var a=[];return this.modifiers.forEach(function(b){if("log"!==b.type)if("value"!==b.type)b.operands.forEach(function(b){a.push(this.evaluateExpression(b))},this);else for(var c=0,d=b.operands.length;d>c;c+=2)a.push(this.evaluateExpression(b.operands[c]))},this),a},setControlFlowInfo:function(a){a&&(this.numberOfDependencyFulfillmentAttempts=a.numberOfDependencyFulfillmentAttempts,this.numberOfCompleteExecutions=a.numberOfCompleteExecutions)},getAndSetControlFlowInfo:function(){var a=LocalStoragePersister.getNodeControlFlowInfo(this.nodeId);this.setControlFlowInfo(a)}}),q=function(){return this.resetChildren=function(){for(var a=0;a<this.children.length;++a)this.children[a].reset()},this.addChildren=function(a,b){for(var c=0;c<a.length;++c){var d=this.createChildNode(a[c]);d&&(d.parent=this,b.push(d))}},this.createChildNode=function(a){return k[a.type]?new k[a.type](a[a.type]):null},this.addVariables=function(a,b){a&&(this.variables||(this.variables=[]),b||(b=this.variables),a.forEach(function(a){if("assignment"===a.type){var c=b.filter(function(b){return b.key===a.assignment.variable});1===c.length?c[0].value=a.assignment.value:b.push({key:a.assignment.variable,value:a.assignment.value})}},this))},this}.call(Object.create(p)),r=function(){return this.shouldExecute=function(){return!this.numberOfCompleteExecutions},this.didExecute=function(){++this.numberOfCompleteExecutions,this.parent.childDidExecute(this),this.persistControlFlowInfo()},this}.call(Object.create(p)),s=function(a){this.newId(),this.numberOfDependencyFulfillmentAttempts=0,this.hasEvaluatedConditional=!1,this.conditionalDidEvaluateToTrue=!1,this.comparable=a.comparable,this.children=[],this.ifChildren=[],this.elseChildren=[],this.addChildren(a.then_statements,this.ifChildren),this.addChildren(a.else_statements||[],this.elseChildren),this.variables=[],this.ifVariables=[],this.elseVariables=[],this.addVariables(a.then_statements,this.ifVariables),this.addVariables(a.else_statements,this.elseVariables),this.modifiers=[],a.modifiers&&this.addModifiers(a.modifiers,this.modifiers),this.shouldExecute=function(){return!this.hasEvaluatedConditional},this.getCommand=function(){for(var a=[this.comparable.type],b=0;b<this.comparable[this.comparable.type].operands.length;++b)a.push(this.evaluateExpression(this.comparable[this.comparable.type].operands[b]));for(var c=new e({name:this.comparable.type+" "+JSON.stringify(a)}),b=0;b<a.length;++b)c.withParameter(a[b]);for(var b=0;b<this.modifiers.length;++b)for(var d=0;d<this.modifiers[b].operands.length;++d)c[this.modifiers[b].type](this.evaluateExpression(this.modifiers[b].operands[d]));return c.withCallback(function(a,b,c){var d=new e("if "+a+" "+b);d[a](b,c),this.conditionalDidEvaluateToTrue=d.execute(),this.children=this.conditionalDidEvaluateToTrue?this.ifChildren:this.elseChildren,this.variables=this.conditionalDidEvaluateToTrue?this.ifVariables:this.elseVariables,this.hasEvaluatedConditional=!0}.bind(this)),c.numFulfillAttempts=this.numberOfDependencyFulfillmentAttempts,c},this.reset=function(){s.prototype.reset.call(this),this.hasEvaluatedConditional=!1,this.conditionalDidEvaluateToTrue=!1,this.resetChildren(),this.persistControlFlowInfo()},this.childDidExecute=function(a){a==this.children[this.children.length-1]&&this.parent.childDidExecute(this),this.persistControlFlowInfo()},this.getControlFlowInfo=function(){var a=s.prototype.getControlFlowInfo.call(this);return a.nodeInfo.hasEvaluatedConditional=this.hasEvaluatedConditional,a.nodeInfo.conditionalDidEvaluateToTrue=this.conditionalDidEvaluateToTrue,a},this.setControlFlowInfo=function(a){a&&(s.prototype.setControlFlowInfo.call(this,a),this.hasEvaluatedConditional=a.hasEvaluatedConditional,this.conditionalDidEvaluateToTrue=a.conditionalDidEvaluateToTrue)},this.resetChildren=function(){for(var a=0;a<this.ifChildren.length;++a)this.ifChildren[a].reset();for(var a=0;a<this.elseChildren.length;++a)this.elseChildren[a].reset()},this.getAndSetControlFlowInfo()};s.prototype=q,k["if"]=s;var t=function(a){this.newId(),this.iterator_var_name=a.iterator_var_name,this.iterator_expr=a.iterator_expr,this.numberOfCompleteExecutions=0,this.numberOfDependencyFulfillmentAttempts=0,this.children=[],this.addChildren(a.statement_list,this.children),this.addVariables(a.statement_list),this.reset=function(){this.numberOfCompleteExecutions=0,this.resetChildren(),this.persistControlFlowInfo()},this.childDidExecute=function(a){if(a==this.children[this.children.length-1]){var b=this.evaluateExpression(this.iterator_expr);b&&++this.numberOfCompleteExecutions<b.length?this.resetChildren():this.parent.childDidExecute(this)}this.persistControlFlowInfo()},this.shouldEnterBlock=function(){var a=this.evaluateExpression(this.iterator_expr);return a&&a.length},this.checkIterationVariable=function(a){if(this.iterator_var_name==a){if("expr_var"==this.iterator_expr.type){var b=this._getVariableValue(this.parent,this.iterator_expr.expr_var.variableName);if(!b)return null;if("object"!=typeof b||!b.length)throw new"invalid array for iterator";return b[this.numberOfCompleteExecutions]}if("expr_arr"==this.iterator_expr.type)return this.iterator_expr.expr_arr[this.numberOfCompleteExecutions];if("expr_dot"==this.iterator_expr.type){var b=this._getVariableValue(this.parent,this.iterator_expr.expr_dot.source.expr_var.variableName);if(!b)return console.log("attempting to access undefined property "+a),null;for(var c=0,d=this.iterator_expr.expr_dot.keys.length;d>c;++c){var e=this.iterator_expr.expr_dot.keys[c],f=!1;if(!b[e]&&b.type&&b[b.type].props){for(var g=0,h=b[b.type].props.length;h>g;++g)b.type&&b[b.type].props[g].key.expr_str===e&&(b=b[b.type].props[g].value,f=!0);if(!f)return console.log('attempting to access undefined property "'+e+'" for iterator variable "'+a+'"'),null;f=!1}else b=b[e]}return"expr_arr"===b.type&&(b=this.evaluateExpression(b)),this.evaluateExpression(b[this.numberOfCompleteExecutions])}throw"invalid iterable"}},this.getAndSetControlFlowInfo()};t.prototype=q,k.each=t;var u=function(a){this.newId(),this.title=this.evaluateExpression(a.command),this.numberOfDependencyFulfillmentAttempts=0,this.numberOfCompleteExecutions=0,this.variables=[],this.modifiers=[],this.addModifiers(a.modifiers,this.modifiers),this.shouldExecute=function(){for(var a=0,b=this.modifiers.length;b>a;++a)if("repeat"===this.modifiers[a].type)return this.numberOfCompleteExecutions-this.evaluateExpression(this.modifiers[a].operands[0])-1;return!this.numberOfCompleteExecutions},this.getCommand=function(){for(var a=new e({name:this.title}),b=0;b<this.modifiers.length;++b)switch(this.modifiers[b].type){case"value":if(2!=this.modifiers[b].operands.length)throw"invalid assignment, 2 operands required, not "+this.modifiers[b].operands.length;for(var c=[],d=0;d<this.modifiers[b].operands.length;++d){var f=this.evaluateExpression(this.modifiers[b].operands[d]);c.push(f)}a.value.apply(a,c);break;case"autocomplete":if(3!=this.modifiers[b].operands.length)throw"invalid autocomplete, 3 operands required, not "+this.modifiers[b].operands.length;for(var c=[],d=0;d<this.modifiers[b].operands.length;++d){var f=this.evaluateExpression(this.modifiers[b].operands[d]);c.push(f)}a.autocomplete.apply(a,c);break;case"goto":if(this.modifiers[b].operands.length>1)throw"invalid goto statement, 1 operand required, not "+this.modifiers[b].operands.length;a["goto"].call(a,this.evaluateExpression(this.modifiers[b].operands[0]));break;case"repeat":if(this.modifiers[b].operands.length>1)throw"invalid repeat statement, 1 operand required, not "+this.modifiers[b].operands.length;break;default:for(var d=0;d<this.modifiers[b].operands.length;++d){var f=this.evaluateExpression(this.modifiers[b].operands[d]);a[this.modifiers[b].type](f)}}return a.numFulfillAttempts=this.numberOfDependencyFulfillmentAttempts,a},this.didExecute=function(){++this.numberOfCompleteExecutions,this.parent.childDidExecute(this),this.persistControlFlowInfo()},this.getAndSetControlFlowInfo()};u.prototype=p,k.command=u;var v=function(a){this.newId(),this.type="checkpoint",this.checkpointInfo=a,this.getCheckpointDescription=function(){return this.evaluateExpression(this.checkpointInfo)},this.getAndSetControlFlowInfo()};v.prototype=r,k.checkpoint=v;var w=function(a){this.newId(),this.type="assert",this.assertInfo=a,this.getModifiersPretty=function(){var a=this.getAssertionResult();return a.description},this.getAssertionResult=function(){var a=this.assertInfo.comparable[this.assertInfo.comparable.type].operands.map(function(a){return this.evaluateExpression(a)},this),b=this.assertInfo.comparable.type+" "+a.map(function(a){return"'"+a+"'"}).join(", "),c=new e({name:"asserting "+b});return c[this.assertInfo.comparable.type].apply(c,a),{result:c.execute(),type:this.assertInfo.comparable.type,description:b}},this.getAndSetControlFlowInfo()};w.prototype=r,k.assert=w;var x=function(a){this.newId(),this.modifiers=[],this.addModifiers(a.options,this.modifiers),this.children=[],this.addChildren(a.statement_list,this.children),this.addVariables(a.statement_list),this.numberOfCompleteExecutions=1,this.reset=function(){}};x.prototype=q;var y=function(a){this.newId(),this.numberOfDependencyFulfillmentAttempts=0,this.inputs=a.inputs,this.children=[],this.addChildren(a.parsed.flytrap.statement_list,this.children),this.addVariables=function(a){y.prototype.addVariables.call(this,a),this.inputs&&this.inputs.forEach(function(a){for(var b=0,c=this.variables.length;c>b;++b)if(this.variables[b].key===a.variable){this.variables[b].value.expr_str=a.value.expr_str;break}},this)},this.addVariables(a.parsed.flytrap.statement_list),this.numberOfCompleteExecutions=1,this.reset=function(){}};y.prototype=q,k.module=y;var z={buildTree:function(a){return new x(a.flytrap)},parse:function(a){var b=this.stripComments(a);return o.parse(b)},stripComments:function(a){if(!a||!a.length||"string"!=typeof a)return"";for(var b=new Array(a.length),c=!1,d=!1,e=!1,f=0,g=a.length;g>f;++f)e||c||d||"'"!==a[f]||"'"===a[f+1]?e&&"'"===a[f]&&"'"!==a[f+1]?(e=!1,b[f]=a[f]):e||c||d||"/"!==a[f]||"/"!==a[f+1]?e||c||d||"/"!==a[f]||"*"!==a[f+1]?!c||"\n"!==a[f]&&"\r"!==a[f]?d&&"*"===a[f]&&a.length-1>f&&"/"===a[f+1]?(d=!1,b[f]=b[f+1]="",++f):b[f]=c||d?"":a[f]:(c=!1,b[f]=a[f]):(d=!0,b[f]=b[f+1]="",++f):(c=!0,b[f]=b[f+1]="",++f):(e=!0,b[f]=a[f]);return b.join("")},attachModules:function(a,b){this.attachParsedRepresentationsToModules(a.flytrap),b(a)},attachParsedRepresentationsToModules:function(a){this._attachParsedRepresentationsToModules(a.statement_list)},_attachParsedRepresentationsToModules:function(a){if(a&&a.length)for(var b=0,c=a.length;c>b;++b){var d=a[b];if("module"===d.type){var e=d.module.name.expr_str,f=document.getElementById("_flytrap_module_"+e);if(!f||!f.innerText)return void console.log("Referenced module "+e+' must have a <script id ="_flytrap_module_'+e+'"> tag containing its automation script.');d.module.parsed=o.parse(f.innerText)}this._attachParsedRepresentationsToModules(d.module?d.module.parsed.flytrap.statement_list:d.statement_list)}}},A={workflowDictionary:{}};A.startWorkflow=function(a){A.workflowDictionary[a].go()},A.startOrResumeWorkflow=function(a,b){new j({name:a,code:b}).go()},A.registerWorkflow=function(a){A.workflowDictionary[a.name]=a},"function"==typeof define?define(function(){return j}):this.Flytrap=j}).call("undefined"!=typeof module?module.exports||this.window:this.window);