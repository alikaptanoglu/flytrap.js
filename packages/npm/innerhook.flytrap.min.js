(function(){function e(){this.ordinal=0}DependencyTypes={Regular:0,Anti:1,SkipIfExists:2,SkipIfNotExists:3,Parameter:4};var t=function(e){this.type=e};(function(){this.isRegular=function(){return this.type===DependencyTypes.Regular},this.isAnti=function(){return this.type===DependencyTypes.Anti},this.isParameter=function(){return this.type===DependencyTypes.Parameter},this.isSkipIfExists=function(){return this.type===DependencyTypes.SkipIfExists},this.isSkipIfNotExists=function(){return this.type===DependencyTypes.SkipIfNotExists}}).call(t.prototype),t.deduce=function(e){if("string"==typeof e)return DependencyTypes.Regular;var t={_anti_:DependencyTypes.Anti,_antidependency_:DependencyTypes.Anti,_parameter_:DependencyTypes.Parameter,_optional_:DependencyTypes.Optional,_skipIfExists_:DependencyTypes.SkipIfExists,_skipIfNotExists_:DependencyTypes.SkipIfNotExists},n=Object.getOwnPropertyNames(e);return 1===n.length?t[n[0]]||DependencyTypes.Regular:DependencyTypes.Regular};var n=function(e,n){this.type=new t(n||t.deduce(e)),this.isFulfilled=!1;var i;this.selector=e._parameter_!==i?e._parameter_:e._anti_||e._antidependency_||e._optional_||e._skipIfExists_||e._skipIfNotExists_||e};(function(){this.attemptToFulfill=function(){if(this.isFulfilled)return!1;var e=n._query(this.selector,!0);return this.type.isRegular()&&e.length>0||this.type.isAnti()&&0==e.length||this.type.isParameter()?(this.isFulfilled=!0,!0):!1},this.getDependencyValue=function(){return this.type.isParameter()?this.selector:n._query(this.selector)},this.isSkippable=function(){var e=n._query(this.selector);return this.type.isSkipIfExists()&&e.length>0||this.type.isSkipIfNotExists()&&0==e.length},this.reset=function(){this.isFulfilled=!1}}).call(n.prototype),n.setDOMContext=function(e){n.DOMContext=e},n.getElements=function(e){return e.map(function(e){return n._query(e)})},n._query=function(e,t){var i="undefined"!=typeof Sizzle;try{var s=i?Sizzle(e,n.DOMContext):document.querySelectorAll(e)}catch(r){t&&console.error(i?r.toString():"selector "+e+" is invalid.  Consider including a reference to Sizzle.js.")}return s||[]};var i=function(){this.dependencies=[]};(function(){this.addDependency=function(e,t){this.dependencies.push(new n(e,t))},this.dependenciesAreFulfilled=function(){for(var e=0;e<this.dependencies.length;++e)if(!this.dependencies[e].attemptToFulfill()&&!this.dependencies[e].isFulfilled)return!1;return!0},this.attemptToFulfillDependencies=function(){for(var e=0;e<this.dependencies.length;++e)this.dependencies[e].attemptToFulfill()},this.reset=function(){for(var e=0;e<this.dependencies.length;++e)this.dependencies[e].reset()},this.shouldBeSkipped=function(){for(var e=0;e<this.dependencies.length;++e)if(this.dependencies[e].isSkippable())return!0;return!1},this.getDependencyValues=function(){for(var e=[],t=0;t<this.dependencies.length;++t)e.push(this.dependencies[t].getDependencyValue());return e},this.convertToDependencyValues=function(e){for(var t=[],i=0;i<e.length;++i)t.push(new n(e[i]).getDependencyValue());return t},this.query=function(e,t){return n._query(e,t)}}).call(i.prototype),i.setDOMContext=function(e){n.setDOMContext(e)},i.getElements=function(e){return n.getElements(e)};var s=function(e){this.totalExecutions=0,this.dependencyManager=new i,this.numFulfillAttempts=0,this.name=e.name||"",this.skipAfter=e.skipAfter||60,this.dependencies=[]||e.dependencies,this.callback=function(){},this.subcommands=[],this.afterDelay=e.runAfterDelay||1e3};(function(){this.click=function(e){this.withDependency(e);var t=new s({name:"Click "+e}).withDependency(e).withCallback(function(e){for(var t=0;t<e.length;++t){var n=new MouseEvent("click",{bubbles:!0});e[t].dispatchEvent(n)}});return this.subcommands.push(t),this},this.bubbleEvent=function(e,t){this.withDependency(e);var n=new s({name:"Bubble "+t+" "+e}).withDependency(e).withParameter(t).withCallback(function(e,t){for(var n=0;n<e.length;++n)e[n].dispatchEvent(new Event(t,{bubbles:!0}))});return this.subcommands.push(n),this},this.hardClick=function(e){return this.bubbleEvent(e,"click")},this.uncheck=function(e){return this.check(e,!1)},this.check=function(e,t){this.withDependency(e),null==t&&(t=!0);var n=new s({name:(t?"Checking ":"Unchecking ")+e}).withDependency(e).withParameter(t).withCallback(function(e,t){for(var n=0;n<e.length;++n)e[n].checked=t});return this.subcommands.push(n),this},this.value=function(e,t){this.withDependency(e),null==t&&(t=!0);var n=new s({name:"Setting value of "+e+" to "+t}).withDependency(e).withParameter(t).withCallback(function(e,t){for(var n=0;n<e.length;++n)e[n].value=t.selector||t});return this.subcommands.push(n),this},this.hash=function(e){var t=new s({name:"Setting window.location.hash: "+e}).withParameter(e).withCallback(function(e){window.location.hash=e});return this.subcommands.push(t),this},this.log=function(e){var t=new s({name:"Logging message: "+e}).withParameter(e).withCallback(function(e){console.log(e)});return this.subcommands.push(t),this},this.focus=function(e){this.withDependency(e);var t=new s({name:"Focus on "+e}).withDependency(e).withCallback(function(e){for(var t=0;t<e.length;++t)e[t].focus()});return this.subcommands.push(t),this},this["goto"]=function(e){var t=new s({name:"Changing URL to "+e}).withParameter(e).withCallback(function(e){window.location.href=e});return this.subcommands.push(t),this},this.autocomplete=function(e,t,n){this.withDependency(e),this.withDependency(e+"_value");var i=new s({name:"Autocomplete "+e}).withDependency(e).withDependency(e+"_value").withParameter(t).withParameter(n).withCallback(function(e,t,n,i){e.val(i+" - "+n),t.val(i);var s=document.createEvent("HTMLEvents");s.initEvent("change",!1,!0),t[0].dispatchEvent(s)});return this.subcommands.push(i),this},this.antidependency=function(e){return this.withDependency({_anti_:e})},this.dependency=this.withDependency=function(e,t){return this.dependencyManager.addDependency(e,t),this},this.parameter=this.withParameter=function(e){return this.withDependency({_parameter_:e}),this},this.run=function(e,t){for(var n=new s({name:"Subcommand callback"}),i=0;i<e.length;++i)void 0!==e[i]._parameter_?n.withParameter(e[i]._parameter_):(this.withDependency(e[i]),n.withDependency(e[i]));return n.withCallback(t),this.subcommands.push(n),this},this.each=this.eachWithDependencyCheck=function(e,t){var n=new s({name:"Subcommand each w/ dep check"}).withParameter(e).withParameter(t).withCallback(function(e,t){for(var n=0;n<e.length;++n)t(e[n],n)});return this.subcommands.push(n),this},this.withCallback=function(e){return this.callback=e,this},this.skipAfterAttempts=function(e){return this.skipAfter=e,this},this.attemptToFulfillDependencies=function(){this.dependencyManager.attemptToFulfillDependencies(),++this.numFulfillAttempts},this.dependenciesAreFulfilled=function(){return this.dependencyManager.dependenciesAreFulfilled()},this.shouldBeSkipped=function(){return this.numFulfillAttempts>this.skipAfter?!0:this.dependencyManager.shouldBeSkipped()},this.afterSeconds=function(e){return this.runAfterDelay(1e3*e)},this.runAfterDelay=function(e){return this.afterDelay=e,this},this.exists=function(e){return this.withParameter(e).withCallback(function(e){return this.dependencyManager.query(e,!0).length>0})},this.execute=function(){for(var e=0;e<this.subcommands.length;++e)this.subcommands[e].execute();var t=this.dependencyManager.getDependencyValues();t.push(this.totalExecutions++);var n=this.callback.apply(this,t);return n},this.reset=function(){numFulfilledAttempts=0,this.dependencyManager.reset();for(var e=0;e<this.subcommands.length;++e)this.subcommands[e].reset()}}).call(s.prototype);var r=function(e,t){var n;this.interval=e,this.callback=t,this.start=function(){this.stop(),n=setTimeout(this.callback,this.interval)},this.stop=function(){clearTimeout(n)}};LocalStoragePersister={};var a="_flytrapP_",o={currentWorkflow:a+"CurrentWorkflow",currentCode:a+"CurrentCode"};if(LocalStoragePersister.getCurrentWorkflow=function(){return sessionStorage.getItem(o.currentWorkflow)},LocalStoragePersister.setCurrentWorkflow=function(e){sessionStorage.setItem(o.currentWorkflow,e)},LocalStoragePersister.persistNodeControlFlowInfo=function(e){var t=e.nodeId,n=JSON.stringify(e.nodeInfo);sessionStorage.setItem(a+t,n)},LocalStoragePersister.getNodeControlFlowInfo=function(e){var t=sessionStorage.getItem(a+e);return JSON.parse(t)},LocalStoragePersister.setCurrentWorkflowCode=function(e){sessionStorage.setItem(o.currentCode,e)},LocalStoragePersister.getCurrentWorkflowCode=function(){return sessionStorage.getItem(o.currentCode)},LocalStoragePersister.clearKeys=function(){for(var e in sessionStorage)sessionStorage.hasOwnProperty(e)&&0===e.indexOf(a)&&sessionStorage.removeItem(e)},"undefined"==typeof Storage)throw"no local storage support";var h=function(e){this.commands=e.commands||[],this.workflowName=e.workflowName,this.defaultSkipAfter=e.defaultSkipAfter||1e3,this.timeInterval=e.timeInterval||1e3,this.dependencyManager=e.dependencyManager,this.persister=e.persister||LocalStoragePersister,this.delegate=e.delegate||{commandDidComplete:function(){},workflowDidComplete:function(){},checkpointWasReached:function(){},assertionDidComplete:function(){},commandMayExecute:function(){}},this.go=function(e){e=e||this.timeInterval;var t=i();t&&u({nodeDesc:t.getModifiersPretty(),inMs:e,selectors:t.getSelectors()}),n.interval=e,LocalStoragePersister.setCurrentWorkflow(this.workflowName),n.start()},this.stop=function(){LocalStoragePersister.setCurrentWorkflow(""),p.reset(),l({name:this.workflowName}),n.stop(),console.log("All done!")};var t=function(){if(this.dependencyManager.dependenciesAreFulfilled()){var e=i();if(!e)return this.persister.clearKeys(),this.stop();var t=this.persister.getNodeControlFlowInfo(e.nodeId);if(e.setControlFlowInfo(t),o(e))return e.didExecute(),void(i()?(a(),this.go()):(this.persister.clearKeys(),this.stop()));var n=e.getCommand();if(!n)return void this.stop();if(n.attemptToFulfillDependencies(),e.numberOfDependencyFulfillmentAttempts++,n.shouldBeSkipped())console.log("[Skipping] "+e.nodeId+" "+n.name+" ... "),e.didExecute(),h(n,e.getControlFlowInfo(),"skipped");else if(n.dependenciesAreFulfilled()){if(console.log(e.nodeId+" "+n.name+" ... "),n.execute(),e.didExecute(),h(n,e.getControlFlowInfo(),"executed"),!i())return this.persister.clearKeys(),void this.stop();a(),this.dependencyManager.reset()}else h(n,e.getControlFlowInfo(),"spinning")}this.go()}.bind(this),n=new r(this.timeInterval,t),i=function(){return s(this.commands)}.bind(this),s=function(e){if(e.shouldExecute())return e;if(!e.shouldEnterBlock())return null;for(var t=0;t<e.children.length;++t){var n=s(e.children[t]);if(n)return n}return null}.bind(this),a=function(){var e=i();this.timeInterval=e.getAfterDelay()||this.timeInterval}.bind(this),o=function(e){switch(e.type){case"assert":return d(e.getAssertionResult()),!0;case"checkpoint":return c(e.getCheckpointDescription()),!0;default:return!1}}.bind(this),h=function(e,t,n){var i={status:n,command:{workflowName:this.workflowName,commandDesc:(e.subcommands[0]||e).name},nodeInfo:t};f(this.delegate.commandDidComplete,i)}.bind(this),l=function(e){f(this.delegate.workflowDidComplete,e)}.bind(this),c=function(e){f(this.delegate.checkpointWasReached,e)}.bind(this),u=function(e){f(this.delegate.commandMayExecute,e)}.bind(this),d=function(e){f(this.delegate.assertionDidComplete,e)}.bind(this),f=function(e,t){null!=e&&setTimeout(function(){e(t)},0)}.bind(this)};window.confirm=function(e){return console.log("Answering YES to: "+e),!0};var l=function(e){if(null==e||null==e.name)throw"A workflow name is required.";if(this.commands=[],this.dependencyManager=new i,this.name=e.name,this["do"]=this.perform=this.addCommand=function(e){var t=new s({name:e});return this.commands.push(t),t},this.withDependency=function(e,t){return this.dependencyManager.addDependency(e,t),this},this.workflowExecutor=null,this.go=function(){this.workflowExecutor=new h({commands:this.annotatedCommands,dependencyManager:this.dependencyManager,workflowName:this.name,delegate:this.delegate}),this.workflowExecutor.go()},this.antidependency=this.withAntidependency=function(e){return this.withDependency({_anti_:e})},this.withCommandTree=function(e){for(var t=0;t<e.modifiers.length;++t)for(var n=0;n<e.modifiers[t].operands.length;++n){var i=e.evaluateExpression(e.modifiers[t].operands[n]);this[e.modifiers[t].type](i)}return this.annotatedCommands=e,this},this.delegate={},this.delegate.commandMayExecute=function(t){var n=i.getElements(t.selectors);n.forEach(function(e){for(var t=0,n=e.length;n>t;++t)e[t].classList.add("flytrap-active-command")}),e.commandMayExecute&&e.commandMayExecute(t)},this.delegate.commandDidComplete=function(t){if("spinning"!==t.status)for(var n=document.getElementsByClassName("flytrap-active-command"),i=n.length-1;i>=0;--i)n[i].classList.remove("flytrap-active-command");e.commandDidComplete&&e.commandDidComplete(t)},this.delegate.workflowDidComplete=e.workflowDidComplete,this.delegate.checkpointWasReached=e.checkpointWasReached,this.delegate.assertionDidComplete=e.assertionDidComplete,null!=e.code){i.setDOMContext(e.DOMContext);var t=C.parse(e.code);C.attachModules(t,function(e){var t=C.buildTree(e);this.withCommandTree(t)}.bind(this))}};l.ExtractModuleReferences=function(e){function t(e,n){if(e&&e.length)for(var i=0,s=e.length;s>i;++i){var r=e[i];"module"===r.type&&r.module.name.expr_str&&n.push(r.module.name.expr_str),t(r.statement_list,n)}}var n=[],i=C.parse(e);return t(i.flytrap.statement_list,n),n};var c={},u=function(e){this.type=e.type,this.operands=e.operands},p=function(){return this.prototype.newId=function(){return this.ordinal++},this.prototype.reset=function(){this.ordinal=0},new this}.call(e),d=function(){function e(){this.yy={}}var t=function(e,t,n,i){for(n=n||{},i=e.length;i--;n[e[i]]=t);return n},n=[1,12],i=[1,13],s=[1,14],r=[1,19],a=[1,20],o=[1,21],h=[1,22],l=[1,23],c=[1,24],u=[1,25],p=[1,26],d=[1,15],f=[1,18],m=[1,16],y=[1,17],g=[1,36],b=[1,32],v=[1,33],_=[1,35],E=[6,20,23,24,29,31,32,33,34,36,37,38,53,55,60,64,67],k=[1,45],x=[1,44],w=[1,46],C=[1,47],I=[1,48],S=[1,51],D=[20,23,24,29,31,32,33,34,36,37,38,53,55,60,67],T=[1,68],A=[6,17,20,22,23,24,29,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67],F=[6,17,20,22,23,24,29,30,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,74,77],O=[1,74],P=[6,17,20,22,23,24,29,30,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,74,77,86],N=[17,22,29,31,32,33,34,36,37,38,39,42,43,45],R=[1,91],$=[1,90],M=[1,89],L=[1,95],V=[6,17,20,22,23,24,29,31,32,33,34,36,37,38,39,42,43,45,53,55,60,64,67],B=[1,97],j=[6,17,20,22,23,24,29,30,31,32,33,34,36,37,38,39,42,43,45,53,55,60,63,64,67,70,74],H=[17,20,23,24,29,31,32,33,34,36,37,38,53,55,60,67],W=[6,17,20,22,23,24,29,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,77],q=[70,77],U=[17,42,63],G=[6,20,23,24,29,31,32,33,34,36,37,38,53,55,58,60,64,67],K=[6,17,20,22,23,24,29,30,31,32,33,34,35,36,37,38,39,42,43,45,53,55,58,59,60,63,64,67,70,74,77,84,86],z={trace:function(){},yy:{},symbols_:{error:2,flytrap_script:3,flytrap_decl:4,stmt_list:5,EOF:6,stmt:7,flytrap_command_decl:8,assignment:9,conditional_stmt:10,each_block:11,execute_stmt:12,FLYTRAP:13,expression:14,flytrap_decl_options:15,flytrap_decl_option:16,ANTIDEPENDENCY:17,expression_list:18,subcommand:19,LEFT_PARENTHESES:20,command_modifiers:21,RIGHT_PARENTHESES:22,CHECKPOINT:23,ASSERT:24,comparable:25,EXISTS:26,command_modifier:27,command_option:28,CLICK:29,BANG:30,CHECK:31,HASH:32,VALUE:33,SET:34,TO:35,FOCUS:36,LOG:37,GOTO:38,AFTER:39,NUMBER:40,seconds:41,DEPENDENCY:42,SKIP:43,attempts:44,REPEAT:45,times:46,SECOND:47,SECONDS:48,TIME:49,TIMES:50,ATTEMPT:51,ATTEMPTS:52,VARIABLE:53,EQUALS:54,EXECUTE:55,with_list:56,"with":57,WITH:58,AS:59,IF:60,conditional_dependencies:61,conditional_block:62,BEGIN:63,END:64,ELSE:65,conditional_dependency:66,EACH:67,IN:68,composition:69,COMMA:70,json_blob:71,array:72,LEFT_BRACKET:73,RIGHT_BRACKET:74,LEFT_BRACE:75,obj_key_list:76,RIGHT_BRACE:77,obj_key:78,PROPERTY:79,COLON:80,concatenation:81,dot_notation:82,dot_list:83,DOT:84,composable:85,PLUS:86,STRING:87,$accept:0,$end:1},terminals_:{2:"error",6:"EOF",13:"FLYTRAP",17:"ANTIDEPENDENCY",20:"LEFT_PARENTHESES",22:"RIGHT_PARENTHESES",23:"CHECKPOINT",24:"ASSERT",26:"EXISTS",29:"CLICK",30:"BANG",31:"CHECK",32:"HASH",33:"VALUE",34:"SET",35:"TO",36:"FOCUS",37:"LOG",38:"GOTO",39:"AFTER",40:"NUMBER",42:"DEPENDENCY",43:"SKIP",45:"REPEAT",47:"SECOND",48:"SECONDS",49:"TIME",50:"TIMES",51:"ATTEMPT",52:"ATTEMPTS",53:"VARIABLE",54:"EQUALS",55:"EXECUTE",58:"WITH",59:"AS",60:"IF",63:"BEGIN",64:"END",65:"ELSE",67:"EACH",68:"IN",70:"COMMA",73:"LEFT_BRACKET",74:"RIGHT_BRACKET",75:"LEFT_BRACE",77:"RIGHT_BRACE",79:"PROPERTY",80:"COLON",84:"DOT",86:"PLUS",87:"STRING"},productions_:[0,[3,3],[5,1],[5,2],[7,1],[7,1],[7,1],[7,1],[7,1],[4,2],[4,3],[15,1],[15,2],[16,2],[8,1],[8,3],[8,2],[8,2],[25,2],[21,1],[21,2],[27,1],[27,1],[19,2],[19,3],[19,2],[19,2],[19,2],[19,4],[19,2],[19,2],[19,2],[28,3],[28,2],[28,2],[28,4],[28,3],[41,1],[41,1],[46,1],[46,1],[44,1],[44,1],[9,3],[12,3],[12,2],[56,1],[56,2],[57,4],[10,4],[10,3],[62,3],[62,7],[61,1],[61,2],[66,2],[66,2],[11,7],[18,1],[18,3],[18,1],[18,3],[14,1],[14,1],[14,1],[72,3],[72,2],[71,3],[76,1],[76,3],[78,3],[78,3],[78,3],[69,1],[82,2],[83,2],[83,3],[81,1],[81,3],[85,1],[85,1],[85,1]],performAction:function(e,t,n,i,s,r){var a=r.length-1;switch(s){case 1:return this.$=r[a-2],this.$.flytrap.statement_list=r[a-1],this.$;case 2:case 11:case 19:case 46:case 53:case 58:case 60:case 75:case 77:this.$=[r[a]];break;case 3:this.$=r[a-1],this.$.push(r[a]);break;case 9:this.$={type:"flytrap",flytrap:{flytrap:r[a],options:[]}};break;case 10:this.$={type:"flytrap",flytrap:{flytrap:r[a-1],options:r[a]}};break;case 12:case 20:this.$=r[a-1],this.$.push(r[a]);break;case 13:case 33:this.$={type:"antidependency",operands:r[a]};break;case 14:this.$={type:"command",command:{command:r[a].type,modifiers:[r[a]]}};break;case 15:this.$={type:"command",command:{command:{type:"expr_str",expr_str:""},modifiers:r[a-1]}};break;case 16:this.$={type:"checkpoint",checkpoint:r[a]};break;case 17:this.$={type:"assert",assert:{comparable:r[a]}};break;case 18:this.$={type:"exists",exists:{operands:[r[a]]}};break;case 23:this.$={type:"click",operands:r[a]};break;case 24:this.$={type:"hardClick",operands:r[a-1]};break;case 25:this.$={type:"check",operands:r[a]};break;case 26:this.$={type:"hash",operands:r[a]};break;case 27:this.$={type:"value",operands:r[a]};break;case 28:this.$={type:"value",operands:[r[a-2],r[a]]};break;case 29:this.$={type:"focus",operands:r[a]};break;case 30:this.$={type:"log",operands:r[a]};break;case 31:this.$={type:"goto",operands:[r[a]]};break;case 32:this.$={type:"afterSeconds",operands:[r[a-1]]};break;case 34:case 55:this.$={type:"dependency",operands:r[a]};break;case 35:this.$={type:"skipAfterAttempts",operands:[r[a-1]]};break;case 36:this.$={type:"repeat",operands:[r[a-1]]};break;case 43:this.$={type:"assignment",assignment:{variable:r[a-2],value:r[a]}};break;case 44:this.$={type:"module",module:{name:r[a-1],inputs:r[a]}};break;case 45:this.$={type:"module",module:{name:r[a]}};break;case 47:this.$=r[a-1],this.$.push(r[a]);break;case 48:this.$={variable:r[a],value:r[a-2]};break;case 49:this.$={type:"if","if":{comparable:r[a-2],then_statements:r[a].then_statements,else_statements:r[a].else_statements,modifiers:r[a-1]}};break;case 50:this.$={type:"if","if":{comparable:r[a-1],then_statements:r[a].then_statements,else_statements:r[a].else_statements}};break;case 51:this.$={then_statements:r[a-1]};break;case 52:this.$={then_statements:r[a-5],else_statements:r[a-1]};break;case 54:this.$=r[a-1],this.$.push(r[a]);break;case 56:this.$={type:"antidependency",operands:r[a]};break;case 57:this.$={type:"each",each:{iterator_var_name:r[a-5],iterator_expr:r[a-3],statement_list:r[a-1]}};break;case 59:case 61:case 69:case 76:case 78:this.$=r[a-2],this.$.push(r[a]);break;case 65:this.$={type:"expr_arr",expr_arr:r[a-1]};break;case 66:this.$={type:"expr_arr",expr_arr:[]};break;case 67:this.$={type:"expr_obj",expr_obj:{props:r[a-1]}};break;case 68:this.$=[r[a]];break;case 70:case 71:case 72:this.$={key:{type:"expr_str",expr_str:r[a-2]},value:r[a]};break;case 73:this.$=1==r[a].length?r[a][0]:{type:"expr_concat",expr_concat:r[a]};break;case 74:this.$={keys:r[a],source:{type:"expr_var",expr_var:{variableName:r[a-1]}}};break;case 79:var o="''"==r[a]?"":r[a].substring(1,this.$.length-1).replace(/\'\'/g,"'");this.$={type:"expr_str",expr_str:o};break;case 80:this.$={type:"expr_var",expr_var:{variableName:r[a]}};break;case 81:this.$=1==r[a].length?r[a][0]:{type:"expr_dot",expr_dot:r[a]}}},table:[{3:1,4:2,13:[1,3]},{1:[3]},{5:4,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,67:y},{14:27,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},{6:[1,38],7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,67:y},t(E,[2,2]),t(E,[2,4]),t(E,[2,5]),t(E,[2,6]),t(E,[2,7]),t(E,[2,8]),t(E,[2,14]),{17:k,19:42,21:40,27:41,28:43,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,39:x,42:w,43:C,45:I},{14:49,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},{25:50,26:S},{54:[1,52]},{25:53,26:S},{53:[1,54]},{14:55,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},{18:56,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{18:59,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{18:60,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{18:61,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{14:62,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},{18:63,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{18:64,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{14:65,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},t(D,[2,9],{15:66,16:67,17:T}),t(A,[2,62]),t(A,[2,63]),t(A,[2,64]),t(F,[2,73],{86:[1,69]}),{18:70,53:g,69:57,71:58,74:[1,71],75:v,81:31,82:37,85:34,87:_},{76:72,78:73,79:O},t(P,[2,77]),t(P,[2,79]),t(P,[2,80],{83:75,84:[1,76]}),t(P,[2,81]),{1:[2,1]},t(E,[2,3]),{17:k,19:42,22:[1,77],27:78,28:43,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,39:x,42:w,43:C,45:I},t(N,[2,19]),t(N,[2,21]),t(N,[2,22]),{40:[1,79]},{18:80,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{18:81,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{39:[1,82]},{40:[1,83]},t(E,[2,16]),t(E,[2,17]),{14:84,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},{14:85,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},{17:R,42:$,61:86,62:87,63:M,66:88},{68:[1,92]},t(E,[2,45],{56:93,57:94,58:L}),t(V,[2,23],{30:[1,96],70:B}),t(j,[2,58]),t(j,[2,60]),t(V,[2,25],{70:B}),t(V,[2,26],{70:B}),t(V,[2,27],{70:B}),{35:[1,98]},t(V,[2,29],{70:B}),t(V,[2,30],{70:B}),t(V,[2,31]),t(D,[2,10],{16:99,17:T}),t(H,[2,11]),{18:100,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{53:g,82:37,85:101,87:_},{70:B,74:[1,102]},t(W,[2,66]),{70:[1,104],77:[1,103]},t(q,[2,68]),{80:[1,105]},t(P,[2,74],{84:[1,106]}),{79:[1,107]},t(E,[2,15]),t(N,[2,20]),{41:108,47:[1,109],48:[1,110]},t(N,[2,33],{70:B}),t(N,[2,34],{70:B}),{40:[1,111]},{46:112,49:[1,113],50:[1,114]},t([6,17,20,23,24,29,31,32,33,34,36,37,38,42,53,55,60,63,64,67],[2,18]),t(E,[2,43]),{17:R,42:$,62:115,63:M,66:116},t(E,[2,50]),t(U,[2,53]),{5:117,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,67:y},{18:118,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{18:119,53:g,69:57,71:58,75:v,81:31,82:37,85:34,87:_},{14:120,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},t(E,[2,44],{57:121,58:L}),t(G,[2,46]),{14:122,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},t(V,[2,24]),{53:g,69:123,71:124,75:v,81:31,82:37,85:34,87:_},{14:125,53:g,69:28,71:30,72:29,73:b,75:v,81:31,82:37,85:34,87:_},t(H,[2,12]),t(H,[2,13],{70:B}),t(P,[2,78]),t(W,[2,65]),t(F,[2,67]),{78:126,79:O},{53:g,69:127,71:128,72:129,73:b,75:v,81:31,82:37,85:34,87:_},{79:[1,130]},t(K,[2,75]),t(N,[2,32]),t(N,[2,37]),t(N,[2,38]),{44:131,51:[1,132],52:[1,133]},t(N,[2,36]),t(N,[2,39]),t(N,[2,40]),t(E,[2,49]),t(U,[2,54]),{7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,64:[1,134],67:y},t(U,[2,55],{70:B}),t(U,[2,56],{70:B}),{63:[1,135]},t(G,[2,47]),{59:[1,136]},t(j,[2,59]),t(j,[2,61]),t(V,[2,28]),t(q,[2,69]),t(q,[2,70]),t(q,[2,71]),t(q,[2,72]),t(K,[2,76]),t(N,[2,35]),t(N,[2,41]),t(N,[2,42]),t(E,[2,51],{65:[1,137]}),{5:138,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,67:y},{53:[1,139]},{63:[1,140]},{7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,64:[1,141],67:y},t(G,[2,48]),{5:142,7:5,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,67:y},t(E,[2,57]),{7:39,8:6,9:7,10:8,11:9,12:10,19:11,20:n,23:i,24:s,29:r,31:a,32:o,33:h,34:l,36:c,37:u,38:p,53:d,55:f,60:m,64:[1,143],67:y},t(E,[2,52])],defaultActions:{38:[2,1]},parseError:function(e,t){if(!t.recoverable)throw new Error(e);this.trace(e)},parse:function(e){function t(){var e;return e=f.lex()||p,"number"!=typeof e&&(e=n.symbols_[e]||e),e}var n=this,i=[0],s=[null],r=[],a=this.table,o="",h=0,l=0,c=0,u=2,p=1,d=r.slice.call(arguments,1),f=Object.create(this.lexer),m={yy:{}};for(var y in this.yy)Object.prototype.hasOwnProperty.call(this.yy,y)&&(m.yy[y]=this.yy[y]);f.setInput(e,m.yy),m.yy.lexer=f,m.yy.parser=this,"undefined"==typeof f.yylloc&&(f.yylloc={});var g=f.yylloc;r.push(g);var b=f.options&&f.options.ranges;this.parseError="function"==typeof m.yy.parseError?m.yy.parseError:Object.getPrototypeOf(this).parseError;for(var v,_,E,k,x,w,C,I,S,D={};;){if(E=i[i.length-1],this.defaultActions[E]?k=this.defaultActions[E]:((null===v||"undefined"==typeof v)&&(v=t()),k=a[E]&&a[E][v]),"undefined"==typeof k||!k.length||!k[0]){var T="";S=[];for(w in a[E])this.terminals_[w]&&w>u&&S.push("'"+this.terminals_[w]+"'");T=f.showPosition?"Parse error on line "+(h+1)+":\n"+f.showPosition()+"\nExpecting "+S.join(", ")+", got '"+(this.terminals_[v]||v)+"'":"Parse error on line "+(h+1)+": Unexpected "+(v==p?"end of input":"'"+(this.terminals_[v]||v)+"'"),this.parseError(T,{text:f.match,token:this.terminals_[v]||v,line:f.yylineno,loc:g,expected:S})}if(k[0]instanceof Array&&k.length>1)throw new Error("Parse Error: multiple actions possible at state: "+E+", token: "+v);switch(k[0]){case 1:i.push(v),s.push(f.yytext),r.push(f.yylloc),i.push(k[1]),v=null,_?(v=_,_=null):(l=f.yyleng,o=f.yytext,h=f.yylineno,g=f.yylloc,c>0&&c--);break;case 2:if(C=this.productions_[k[1]][1],D.$=s[s.length-C],D._$={first_line:r[r.length-(C||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(C||1)].first_column,last_column:r[r.length-1].last_column},b&&(D._$.range=[r[r.length-(C||1)].range[0],r[r.length-1].range[1]]),x=this.performAction.apply(D,[o,l,h,m.yy,k[1],s,r].concat(d)),"undefined"!=typeof x)return x;C&&(i=i.slice(0,-1*C*2),s=s.slice(0,-1*C),r=r.slice(0,-1*C)),i.push(this.productions_[k[1]][0]),s.push(D.$),r.push(D._$),I=a[i[i.length-2]][i[i.length-1]],i.push(I);break;case 3:return!0}}return!0}},Y=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e,t){return this.yy=t||this.yy||{},this._input=e,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var s=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[s[0],s[0]+this.yyleng-t]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},test_match:function(e,t){var n,i,s;if(this.options.backtrack_lexer&&(s={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(s.yylloc.range=this.yylloc.range.slice(0))),i=e[0].match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],n=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var r in s)this[r]=s[r];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i;this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),r=0;r<s.length;r++)if(n=this._input.match(this.rules[s[r]]),n&&(!t||n[0].length>t[0].length)){if(t=n,i=r,this.options.backtrack_lexer){if(e=this.test_match(n,s[r]),e!==!1)return e;if(this._backtrack){t=!1;continue}return!1}if(!this.options.flex)break}return t?(e=this.test_match(t,s[i]),e!==!1?e:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){var e=this.conditionStack.length-1;return e>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(e){return e=this.conditionStack.length-1-Math.abs(e||0),e>=0?this.conditionStack[e]:"INITIAL"},pushState:function(e){
this.begin(e)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(e,t,n,i){switch(n){case 0:break;case 1:return 40;case 2:return 87;case 3:return 13;case 4:return 17;case 5:return 42;case 6:return"PERFORM";case 7:return 29;case 8:return 31;case 9:return 32;case 10:return 39;case 11:return 48;case 12:return 47;case 13:return 60;case 14:return 26;case 15:return 63;case 16:return 64;case 17:return 65;case 18:return 30;case 19:return 33;case 20:return 36;case 21:return 38;case 22:return 37;case 23:return 34;case 24:return 35;case 25:return 43;case 26:return 39;case 27:return 52;case 28:return 51;case 29:return 45;case 30:return 50;case 31:return 49;case 32:return"FOR";case 33:return 67;case 34:return 68;case 35:return 23;case 36:return 24;case 37:return 55;case 38:return 58;case 39:return 59;case 40:return 53;case 41:return 79;case 42:return 54;case 43:return 70;case 44:return 84;case 45:return 73;case 46:return 74;case 47:return 75;case 48:return 77;case 49:return 80;case 50:return 86;case 51:return 20;case 52:return 22;case 53:return 6}},rules:[/^(?:\s+)/,/^(?:[0-9]+(\.[0-9]+)?\b)/,/^(?:'(?:[^\']+|'')+'|'')/,/^(?:flytrap\b)/,/^(?:antidependency\b)/,/^(?:dependency\b)/,/^(?:perform\b)/,/^(?:click\b)/,/^(?:check\b)/,/^(?:hash\b)/,/^(?:after\b)/,/^(?:seconds\b)/,/^(?:second\b)/,/^(?:if\b)/,/^(?:exists\b)/,/^(?:begin\b)/,/^(?:end\b)/,/^(?:else\b)/,/^(?:!)/,/^(?:value\b)/,/^(?:focus\b)/,/^(?:goto\b)/,/^(?:log\b)/,/^(?:set\b)/,/^(?:to\b)/,/^(?:skip\b)/,/^(?:after\b)/,/^(?:attempts\b)/,/^(?:attempt\b)/,/^(?:repeat\b)/,/^(?:times\b)/,/^(?:time\b)/,/^(?:for\b)/,/^(?:each\b)/,/^(?:in\b)/,/^(?:checkpoint\b)/,/^(?:assert\b)/,/^(?:execute\b)/,/^(?:with\b)/,/^(?:as\b)/,/^(?:@[A-Za-z0-9_]+)/,/^(?:[A-Za-z0-9_]+)/,/^(?:=)/,/^(?:,)/,/^(?:\.)/,/^(?:\[)/,/^(?:\])/,/^(?:\{)/,/^(?:\})/,/^(?::)/,/^(?:\+)/,/^(?:\()/,/^(?:\))/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53],inclusive:!0}}};return e}();return z.lexer=Y,e.prototype=z,z.Parser=e,new e}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=d,exports.Parser=d.Parser,exports.parse=function(){return d.parse.apply(d,arguments)},exports.main=function(e){e[1]||(console.log("Usage: "+e[0]+" FILE"),process.exit(1));var t=require("fs").readFileSync(require("path").normalize(e[1]),"utf8");return exports.parser.parse(t)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1)));var f=d,m=Object.create({parent:null,type:null,modifiers:[],variables:[],nodeId:0,children:[],numberOfDependencyFulfillmentAttempts:0,numberOfCompleteExecutions:0,newId:function(){this.nodeId=p.newId()},didExecute:function(){},shouldExecute:function(){return!1},childDidExecute:function(){},shouldEnterBlock:function(){return!0},reset:function(){this.numberOfCompleteExecutions=0,this.numberOfDependencyFulfillmentAttempts=0,this.persistControlFlowInfo()},persistControlFlowInfo:function(){LocalStoragePersister.persistNodeControlFlowInfo(this.getControlFlowInfo())},getCommand:function(){return null},addModifiers:function(e,t){for(var n=0,i=e.length;i>n;++n)t.push(new u(e[n]))},evaluateExpression:function(e){switch(e.type){case"expr_str":return e.expr_str;case"expr_var":return this.getVariableValue(e.expr_var.variableName);case"expr_arr":return e.expr_arr;case"expr_concat":for(var t="",n=0,i=e.expr_concat.length;i>n;++n)t+=this.evaluateExpression(e.expr_concat[n]);return t;case"expr_obj":for(var t={},n=0,i=e.expr_obj.props.length;i>n;++n){var s=e.expr_obj.props[n];t[this.evaluateExpression(s.key)]=this.evaluateExpression(s.value)}return t;case"expr_dot":var t=this.evaluateExpression(e.expr_dot.source);if(!t)return null;for(var n=0,i=e.expr_dot.keys.length;i>n;++n){var r=e.expr_dot.keys[n];t=t[r]}return t;default:return e}},getVariableValue:function(e){return this._getVariableValue(this,e)},_getVariableValue:function(e,t){if(!e)return null;var n=e.checkIterationVariable(t);if(n)return n;if(e.variables)for(var i=0,s=e.variables.length;s>i;++i)if(e.variables[i].key==t){var r=e.variables[i].value;return"string"==typeof r?r:this.evaluateExpression(r)}var a=this._getVariableValue(e.parent,t);return a?this.evaluateExpression(a):null},checkIterationVariable:function(){return null},getAfterDelay:function(){for(var e=0,t=this.modifiers.length;t>e;++e)if("afterSeconds"==this.modifiers[e].type)return 1e3*this.modifiers[e].operands[0];return 1e3},getControlFlowInfo:function(){return{nodeId:this.nodeId,nodeInfo:{numberOfDependencyFulfillmentAttempts:this.numberOfDependencyFulfillmentAttempts,numberOfCompleteExecutions:this.numberOfCompleteExecutions}}},getModifiersPretty:function(){var e=this.modifiers.map(function(e){var t=e.operands.map(function(e){return"'"+this.evaluateExpression(e)+"'"},this);return e.type+" "+t.join(", ")},this);return e.join(";")},getSelectors:function(){var e=[];return this.modifiers.forEach(function(t){if("log"!==t.type)if("value"!==t.type)t.operands.forEach(function(t){e.push(this.evaluateExpression(t))},this);else for(var n=0,i=t.operands.length;i>n;n+=2)e.push(this.evaluateExpression(t.operands[n]))},this),e},setControlFlowInfo:function(e){e&&(this.numberOfDependencyFulfillmentAttempts=e.numberOfDependencyFulfillmentAttempts,this.numberOfCompleteExecutions=e.numberOfCompleteExecutions)},getAndSetControlFlowInfo:function(){var e=LocalStoragePersister.getNodeControlFlowInfo(this.nodeId);this.setControlFlowInfo(e)}}),y=function(){return this.resetChildren=function(){for(var e=0;e<this.children.length;++e)this.children[e].reset()},this.addChildren=function(e,t){for(var n=0;n<e.length;++n){var i=this.createChildNode(e[n]);i&&(i.parent=this,t.push(i))}},this.createChildNode=function(e){return c[e.type]?new c[e.type](e[e.type]):null},this.addVariables=function(e,t){e&&(this.variables||(this.variables=[]),t||(t=this.variables),e.forEach(function(e){if("assignment"===e.type){var n=t.filter(function(t){return t.key===e.assignment.variable});1===n.length?n[0].value=e.assignment.value:t.push({key:e.assignment.variable,value:e.assignment.value})}},this))},this}.call(Object.create(m)),g=function(){return this.shouldExecute=function(){return!this.numberOfCompleteExecutions},this.didExecute=function(){++this.numberOfCompleteExecutions,this.parent.childDidExecute(this),this.persistControlFlowInfo()},this}.call(Object.create(m)),b=function(e){this.newId(),this.numberOfDependencyFulfillmentAttempts=0,this.hasEvaluatedConditional=!1,this.conditionalDidEvaluateToTrue=!1,this.comparable=e.comparable,this.children=[],this.ifChildren=[],this.elseChildren=[],this.addChildren(e.then_statements,this.ifChildren),this.addChildren(e.else_statements||[],this.elseChildren),this.variables=[],this.ifVariables=[],this.elseVariables=[],this.addVariables(e.then_statements,this.ifVariables),this.addVariables(e.else_statements,this.elseVariables),this.modifiers=[],e.modifiers&&this.addModifiers(e.modifiers,this.modifiers),this.shouldExecute=function(){return!this.hasEvaluatedConditional},this.getCommand=function(){for(var e=[this.comparable.type],t=0;t<this.comparable[this.comparable.type].operands.length;++t)e.push(this.evaluateExpression(this.comparable[this.comparable.type].operands[t]));for(var n=new s({name:this.comparable.type+" "+JSON.stringify(e)}),t=0;t<e.length;++t)n.withParameter(e[t]);for(var t=0;t<this.modifiers.length;++t)for(var i=0;i<this.modifiers[t].operands.length;++i)n[this.modifiers[t].type](this.evaluateExpression(this.modifiers[t].operands[i]));return n.withCallback(function(e,t,n){var i=new s("if "+e+" "+t);i[e](t,n),this.conditionalDidEvaluateToTrue=i.execute(),this.children=this.conditionalDidEvaluateToTrue?this.ifChildren:this.elseChildren,this.variables=this.conditionalDidEvaluateToTrue?this.ifVariables:this.elseVariables,this.hasEvaluatedConditional=!0}.bind(this)),n.numFulfillAttempts=this.numberOfDependencyFulfillmentAttempts,n},this.reset=function(){b.prototype.reset.call(this),this.hasEvaluatedConditional=!1,this.conditionalDidEvaluateToTrue=!1,this.resetChildren(),this.persistControlFlowInfo()},this.childDidExecute=function(e){e==this.children[this.children.length-1]&&this.parent.childDidExecute(this),this.persistControlFlowInfo()},this.getControlFlowInfo=function(){var e=b.prototype.getControlFlowInfo.call(this);return e.nodeInfo.hasEvaluatedConditional=this.hasEvaluatedConditional,e.nodeInfo.conditionalDidEvaluateToTrue=this.conditionalDidEvaluateToTrue,e},this.setControlFlowInfo=function(e){e&&(b.prototype.setControlFlowInfo.call(this,e),this.hasEvaluatedConditional=e.hasEvaluatedConditional,this.conditionalDidEvaluateToTrue=e.conditionalDidEvaluateToTrue)},this.resetChildren=function(){for(var e=0;e<this.ifChildren.length;++e)this.ifChildren[e].reset();for(var e=0;e<this.elseChildren.length;++e)this.elseChildren[e].reset()},this.getAndSetControlFlowInfo()};b.prototype=y,c["if"]=b;var v=function(e){this.newId(),this.iterator_var_name=e.iterator_var_name,this.iterator_expr=e.iterator_expr,this.numberOfCompleteExecutions=0,this.numberOfDependencyFulfillmentAttempts=0,this.children=[],this.addChildren(e.statement_list,this.children),this.addVariables(e.statement_list),this.reset=function(){this.numberOfCompleteExecutions=0,this.resetChildren(),this.persistControlFlowInfo()},this.childDidExecute=function(e){if(e==this.children[this.children.length-1]){var t=this.evaluateExpression(this.iterator_expr);t&&++this.numberOfCompleteExecutions<t.length?this.resetChildren():this.parent.childDidExecute(this)}this.persistControlFlowInfo()},this.shouldEnterBlock=function(){var e=this.evaluateExpression(this.iterator_expr);return e&&e.length},this.checkIterationVariable=function(e){if(this.iterator_var_name==e){if("expr_var"==this.iterator_expr.type){var t=this._getVariableValue(this.parent,this.iterator_expr.expr_var.variableName);if(!t)return null;if("object"!=typeof t||!t.length)throw new"invalid array for iterator";return t[this.numberOfCompleteExecutions]}if("expr_arr"==this.iterator_expr.type)return this.iterator_expr.expr_arr[this.numberOfCompleteExecutions];if("expr_dot"==this.iterator_expr.type){var t=this._getVariableValue(this.parent,this.iterator_expr.expr_dot.source.expr_var.variableName);if(!t)return console.log("attempting to access undefined property "+e),null;for(var n=0,i=this.iterator_expr.expr_dot.keys.length;i>n;++n){var s=this.iterator_expr.expr_dot.keys[n],r=!1;if(!t[s]&&t.type&&t[t.type].props){for(var a=0,o=t[t.type].props.length;o>a;++a)t.type&&t[t.type].props[a].key.expr_str===s&&(t=t[t.type].props[a].value,r=!0);if(!r)return console.log('attempting to access undefined property "'+s+'" for iterator variable "'+e+'"'),null;r=!1}else t=t[s]}return"expr_arr"===t.type&&(t=this.evaluateExpression(t)),this.evaluateExpression(t[this.numberOfCompleteExecutions])}throw"invalid iterable"}},this.getAndSetControlFlowInfo()};v.prototype=y,c.each=v;var _=function(e){this.newId(),this.title=this.evaluateExpression(e.command),this.numberOfDependencyFulfillmentAttempts=0,this.numberOfCompleteExecutions=0,this.variables=[],this.modifiers=[],this.addModifiers(e.modifiers,this.modifiers),this.shouldExecute=function(){for(var e=0,t=this.modifiers.length;t>e;++e)if("repeat"===this.modifiers[e].type)return this.numberOfCompleteExecutions-this.evaluateExpression(this.modifiers[e].operands[0])-1;return!this.numberOfCompleteExecutions},this.getCommand=function(){for(var e=new s({name:this.title}),t=0;t<this.modifiers.length;++t)switch(this.modifiers[t].type){case"value":if(2!=this.modifiers[t].operands.length)throw"invalid assignment, 2 operands required, not "+this.modifiers[t].operands.length;for(var n=[],i=0;i<this.modifiers[t].operands.length;++i){var r=this.evaluateExpression(this.modifiers[t].operands[i]);n.push(r)}e.value.apply(e,n);break;case"autocomplete":if(3!=this.modifiers[t].operands.length)throw"invalid autocomplete, 3 operands required, not "+this.modifiers[t].operands.length;for(var n=[],i=0;i<this.modifiers[t].operands.length;++i){var r=this.evaluateExpression(this.modifiers[t].operands[i]);n.push(r)}e.autocomplete.apply(e,n);break;case"goto":if(this.modifiers[t].operands.length>1)throw"invalid goto statement, 1 operand required, not "+this.modifiers[t].operands.length;e["goto"].call(e,this.evaluateExpression(this.modifiers[t].operands[0]));break;case"repeat":if(this.modifiers[t].operands.length>1)throw"invalid repeat statement, 1 operand required, not "+this.modifiers[t].operands.length;break;default:for(var i=0;i<this.modifiers[t].operands.length;++i){var r=this.evaluateExpression(this.modifiers[t].operands[i]);e[this.modifiers[t].type](r)}}return e.numFulfillAttempts=this.numberOfDependencyFulfillmentAttempts,e},this.didExecute=function(){++this.numberOfCompleteExecutions,this.parent.childDidExecute(this),this.persistControlFlowInfo()},this.getAndSetControlFlowInfo()};_.prototype=m,c.command=_;var E=function(e){this.newId(),this.type="checkpoint",this.checkpointInfo=e,this.getCheckpointDescription=function(){return this.evaluateExpression(this.checkpointInfo)},this.getAndSetControlFlowInfo()};E.prototype=g,c.checkpoint=E;var k=function(e){this.newId(),this.type="assert",this.assertInfo=e,this.getModifiersPretty=function(){var e=this.getAssertionResult();return e.description},this.getAssertionResult=function(){var e=this.assertInfo.comparable[this.assertInfo.comparable.type].operands.map(function(e){return this.evaluateExpression(e)},this),t=this.assertInfo.comparable.type+" "+e.map(function(e){return"'"+e+"'"}).join(", "),n=new s({name:"asserting "+t});return n[this.assertInfo.comparable.type].apply(n,e),{result:n.execute(),type:this.assertInfo.comparable.type,description:t}},this.getAndSetControlFlowInfo()};k.prototype=g,c.assert=k;var x=function(e){this.newId(),this.modifiers=[],this.addModifiers(e.options,this.modifiers),this.children=[],this.addChildren(e.statement_list,this.children),this.addVariables(e.statement_list),this.numberOfCompleteExecutions=1,this.reset=function(){}};x.prototype=y;var w=function(e){this.newId(),this.numberOfDependencyFulfillmentAttempts=0,this.inputs=e.inputs,this.children=[],this.addChildren(e.parsed.flytrap.statement_list,this.children),this.addVariables=function(e){w.prototype.addVariables.call(this,e),this.inputs&&this.inputs.forEach(function(e){for(var t=0,n=this.variables.length;n>t;++t)if(this.variables[t].key===e.variable){this.variables[t].value.expr_str=e.value.expr_str;break}},this)},this.addVariables(e.parsed.flytrap.statement_list),this.numberOfCompleteExecutions=1,this.reset=function(){}};w.prototype=y,c.module=w;var C={buildTree:function(e){return new x(e.flytrap)},parse:function(e){var t=this.stripComments(e);return f.parse(t)},stripComments:function(e){if(!e||!e.length||"string"!=typeof e)return"";for(var t=new Array(e.length),n=!1,i=!1,s=!1,r=0,a=e.length;a>r;++r)s||n||i||"'"!==e[r]||"'"===e[r+1]?s&&"'"===e[r]&&"'"!==e[r+1]?(s=!1,t[r]=e[r]):s||n||i||"/"!==e[r]||"/"!==e[r+1]?s||n||i||"/"!==e[r]||"*"!==e[r+1]?!n||"\n"!==e[r]&&"\r"!==e[r]?i&&"*"===e[r]&&e.length-1>r&&"/"===e[r+1]?(i=!1,t[r]=t[r+1]="",++r):t[r]=n||i?"":e[r]:(n=!1,t[r]=e[r]):(i=!0,t[r]=t[r+1]="",++r):(n=!0,t[r]=t[r+1]="",++r):(s=!0,t[r]=e[r]);return t.join("")},attachModules:function(e,t){this.attachParsedRepresentationsToModules(e.flytrap),t(e)},attachParsedRepresentationsToModules:function(e){this._attachParsedRepresentationsToModules(e.statement_list)},_attachParsedRepresentationsToModules:function(e){if(e&&e.length)for(var t=0,n=e.length;n>t;++t){var i=e[t];if("module"===i.type){var s=i.module.name.expr_str,r=document.getElementById("_flytrap_module_"+s);if(!r||!r.innerText)return void console.log("Referenced module "+s+' must have a <script id ="_flytrap_module_'+s+'"> tag containing its automation script.');i.module.parsed=f.parse(r.innerText)}this._attachParsedRepresentationsToModules(i.module?i.module.parsed.flytrap.statement_list:i.statement_list)}}},I={workflowDictionary:{}};I.startWorkflow=function(e){I.workflowDictionary[e].go()},I.startOrResumeWorkflow=function(e,t){new l({name:e,code:t}).go()},I.registerWorkflow=function(e){I.workflowDictionary[e.name]=e},"function"==typeof define?define(function(){return l}):this.Flytrap=l}).call("undefined"!=typeof module?module.exports||this.window:this.window);